# ğŸš€ å›½å†…ä¸€é”®æ¨é€ Docker é•œåƒ

**æ— éœ€ä»£ç†ï¼Œç›´æ¥æ¨é€åˆ° Docker Hub (baimastryke)**

---

## âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

### æ­¥éª¤1: é…ç½® Docker é•œåƒåŠ é€Ÿå™¨

```bash
cd /home/master/code/nofx/nofx
./setup_docker_china.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨é…ç½®å›½å†… Docker é•œåƒåŠ é€Ÿå™¨
- âœ… å¤‡ä»½æ‚¨çš„ç°æœ‰é…ç½®
- âœ… é‡å¯ Docker æœåŠ¡
- âœ… è‡ªåŠ¨æµ‹è¯•é…ç½®æ˜¯å¦æˆåŠŸ

### æ­¥éª¤2: ç™»å½• Docker Hub

```bash
docker login
```

- **ç”¨æˆ·å**: `baimastryke`
- **å¯†ç **: è¾“å…¥æ‚¨çš„ Docker Hub å¯†ç 

### æ­¥éª¤3: ä¸€é”®æ„å»ºæ¨é€

```bash
./ä¸€é”®æ¨é€.sh
```

æˆ–è€…ä½¿ç”¨ï¼š

```bash
./quick_build_push.sh
```

---

## ğŸ¯ æ—¥å¸¸ä½¿ç”¨ï¼ˆå·²é…ç½®å®Œæˆåï¼‰

é…ç½®å®Œæˆåï¼Œæ¯æ¬¡åªéœ€è¦è¿è¡Œï¼š

```bash
cd /home/master/code/nofx/nofx
./ä¸€é”®æ¨é€.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æŸ¥ Docker é…ç½®
2. âœ… æ£€æŸ¥ç™»å½•çŠ¶æ€
3. âœ… æ„å»ºåç«¯é•œåƒ
4. âœ… æ„å»ºå‰ç«¯é•œåƒ
5. âœ… æ¨é€åˆ° Docker Hub (baimastryke)

---

## ğŸ“¦ æ¨é€çš„é•œåƒ

æ‰€æœ‰é•œåƒéƒ½ä¼šæ¨é€åˆ°æ‚¨çš„ Docker Hub è´¦å·ï¼š

- `baimastryke/nofx-backend:latest`
- `baimastryke/nofx-backend:æ—¥æœŸæ ‡ç­¾`
- `baimastryke/nofx-frontend:latest`
- `baimastryke/nofx-frontend:æ—¥æœŸæ ‡ç­¾`

---

## ğŸ”§ å·¥ä½œåŸç†

### å›½å†…é•œåƒåŠ é€Ÿå™¨

è„šæœ¬é…ç½®äº†å¤šä¸ªå›½å†…é•œåƒåŠ é€Ÿå™¨ï¼š
- `https://docker.1panel.live`
- `https://docker.m.daocloud.io`
- `https://docker.unsee.tech`
- `https://docker.awsl9527.cn`

è¿™äº›åŠ é€Ÿå™¨ä¼šï¼š
1. åŠ é€ŸåŸºç¡€é•œåƒçš„ä¸‹è½½ï¼ˆå¦‚ alpineã€golangï¼‰
2. ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ä¸­çš„ç½‘ç»œè®¿é—®
3. ä½œä¸ºä¸­è½¬ï¼Œä½¿æ¨é€åˆ° Docker Hub æ›´ç¨³å®š

### Dockerfile ä¼˜åŒ–

å·²é…ç½®å›½å†…é•œåƒæºï¼š

```dockerfile
# Alpine ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ
RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories

# Go ä½¿ç”¨å›½å†…ä»£ç†
ENV GOPROXY=https://goproxy.cn,https://mirrors.aliyun.com/goproxy/,direct
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: æ¨é€æ—¶ä»ç„¶è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ

**æ–¹æ¡ˆ1: é‡æ–°é…ç½® Docker**
```bash
./setup_docker_china.sh
```

**æ–¹æ¡ˆ2: æ£€æŸ¥ Docker é…ç½®**
```bash
# æŸ¥çœ‹é•œåƒåŠ é€Ÿå™¨é…ç½®
docker info | grep -A 5 "Registry Mirrors"

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# Registry Mirrors:
#   https://docker.1panel.live/
#   https://docker.m.daocloud.io/
```

**æ–¹æ¡ˆ3: æ‰‹åŠ¨é‡å¯ Docker**
```bash
sudo systemctl restart docker
```

### Q2: ç™»å½• Docker Hub å¤±è´¥

```bash
# é‡æ–°ç™»å½•
docker logout
docker login
# ç”¨æˆ·å: baimastryke
# å¯†ç : æ‚¨çš„ Docker Hub å¯†ç 
```

### Q3: æ„å»ºè¿‡ç¨‹ä¸­ç½‘ç»œè¶…æ—¶

è¿™é€šå¸¸æ˜¯å› ä¸º Docker daemon é…ç½®æœªç”Ÿæ•ˆï¼š

```bash
# 1. ç¡®è®¤é…ç½®æ–‡ä»¶å­˜åœ¨
cat /etc/docker/daemon.json

# 2. é‡å¯ Docker
sudo systemctl daemon-reload
sudo systemctl restart docker

# 3. éªŒè¯é…ç½®
docker info | grep "Registry Mirrors"
```

### Q4: å¦‚ä½•æŸ¥çœ‹æ„å»ºæ—¥å¿—

```bash
# ä½¿ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼
docker compose build --progress=plain nofx
```

---

## ğŸ“ è‡ªå®šä¹‰é•œåƒæ ‡ç­¾

é»˜è®¤ä½¿ç”¨æ—¥æœŸä½œä¸ºæ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼š`2025-11-27`ï¼‰ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰ï¼š

```bash
# æ–¹å¼1: è®¾ç½®ç¯å¢ƒå˜é‡
export IMAGE_TAG="v1.2.3"
./quick_build_push.sh

# æ–¹å¼2: ä¸´æ—¶æŒ‡å®š
IMAGE_TAG="v1.2.3" ./quick_build_push.sh
```

---

## ğŸ” éªŒè¯æ¨é€æˆåŠŸ

æ¨é€å®Œæˆåï¼Œè®¿é—®ï¼š

- https://hub.docker.com/r/baimastryke/nofx-backend
- https://hub.docker.com/r/baimastryke/nofx-frontend

æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
# æŸ¥çœ‹é•œåƒä¿¡æ¯
docker manifest inspect baimastryke/nofx-backend:latest

# åœ¨å…¶ä»–æœºå™¨æ‹‰å–æµ‹è¯•
docker pull baimastryke/nofx-backend:latest
docker pull baimastryke/nofx-frontend:latest
```

---

## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²

æ¨é€æˆåŠŸåï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼š

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh -i A.pem ubuntu@43.202.115.56

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ubuntu/nofx

# æ‹‰å–æœ€æ–°é•œåƒ
docker compose -f docker-compose.prod.yml pull

# é‡å¯æœåŠ¡
docker compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.yml logs -f
```

---

## ğŸ“Š è„šæœ¬æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `ä¸€é”®æ¨é€.sh` | ä¸€é”®è¿è¡Œè„šæœ¬ï¼Œè‡ªåŠ¨æ£€æŸ¥é…ç½®å’Œç™»å½• |
| `quick_build_push.sh` | æ ¸å¿ƒæ„å»ºæ¨é€è„šæœ¬ |
| `setup_docker_china.sh` | Docker é…ç½®è„šæœ¬ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰ |
| `docker-daemon-china.json` | Docker daemon é…ç½®æ–‡ä»¶ |

---

## ğŸ‰ æ€»ç»“

**é¦–æ¬¡é…ç½®ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰ï¼š**
```bash
./setup_docker_china.sh  # é…ç½® Docker
docker login              # ç™»å½• Docker Hub (baimastryke)
```

**æ—¥å¸¸ä½¿ç”¨ï¼š**
```bash
./ä¸€é”®æ¨é€.sh            # ä¸€é”®æ„å»ºæ¨é€
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼âœ¨

---

## ğŸ’¡ æç¤º

- âœ… Docker Hub ç”¨æˆ·åå·²å›ºå®šä¸º `baimastryke`ï¼Œæ— éœ€ä¿®æ”¹
- âœ… ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå™¨ï¼Œæ— éœ€ä»£ç†
- âœ… æ‰€æœ‰é…ç½®éƒ½ä¼šè‡ªåŠ¨å®Œæˆ
- âœ… æ¨é€é€Ÿåº¦å¿«ï¼Œç¨³å®šå¯é 

**é‡åˆ°é—®é¢˜ï¼Ÿ** å…ˆè¿è¡Œ `./setup_docker_china.sh` é‡æ–°é…ç½® Dockerï¼



