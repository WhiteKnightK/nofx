# å¤šç”¨æˆ·è§‚æµ‹ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆæœ€å°åŒ–ä¿®æ”¹ç‰ˆï¼‰

## ğŸ“‹ æ¦‚è¿°

å®ç°ä¸€ä¸ªå››çº§æƒé™çš„æ•°æ®è§‚æµ‹ç³»ç»Ÿï¼Œæ”¯æŒï¼š
1. **çœŸæ­£çš„ç®¡ç†å‘˜ï¼ˆAdminï¼‰** - å¯ä»¥ç®¡ç†æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼‰ã€åˆ†ç±»ã€åˆ›å»ºè´¦å·ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨ï¼‰
2. **æ™®é€šç”¨æˆ·ï¼ˆUserï¼‰** - å¯ä»¥åˆ›å»ºåˆ†ç±»ï¼Œç®¡ç†è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼Œä¸ºäº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼Œä¸ºåˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·
3. **å°ç»„ç»„é•¿ï¼ˆGroup Leaderï¼‰** - å¯ä»¥æŸ¥çœ‹æŒ‡å®šåˆ†ç±»çš„æ‰€æœ‰äº¤æ˜“å‘˜æ•°æ®ï¼ˆåªè¯»ï¼‰
4. **äº¤æ˜“å‘˜è´¦å·ï¼ˆTrader Accountï¼‰** - åªèƒ½æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜æ•°æ®ï¼ˆåªè¯»ï¼‰

**æ³¨æ„ï¼š** ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ä¸‰çº§æƒé™ä½“ç³»ï¼ˆUser / Group Leader / Trader Accountï¼‰ï¼ŒAdminä½œä¸ºç‰¹æ®Šè§’è‰²ä¿ç•™ä½†ä¸å¸¸ç”¨ã€‚

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºåˆ†ç±»ï¼Œç®¡ç†è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼ˆæ•°æ®éš”ç¦»ï¼‰
- åˆ†ç±»å±äºåˆ›å»ºå®ƒçš„ç”¨æˆ·ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šä¸ªåˆ†ç±»
- äº¤æ˜“å‘˜å±äºæŸä¸ªåˆ†ç±»ï¼Œäº¤æ˜“å‘˜è´¦å·ç»§æ‰¿äº¤æ˜“å‘˜çš„åˆ†ç±»
- **æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆTrader Accountï¼‰**
- **æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆGroup Leaderï¼‰**
- å°ç»„ç»„é•¿å¯ä»¥è§‚æµ‹æŒ‡å®šåˆ†ç±»ï¼ˆåªèƒ½æ˜¯è‡ªå·±åˆ›å»ºçš„åˆ†ç±»ï¼‰
- é™¤äº†æ™®é€šç”¨æˆ·ï¼Œå…¶ä»–äººåªèƒ½æŸ¥çœ‹é¢æ¿ï¼Œä¸èƒ½é…ç½®ï¼ˆéšè—é…ç½®åŠŸèƒ½ï¼‰

**ä»å±å…³ç³»é“¾ï¼š**
```
æ³¨å†Œç”¨æˆ·ï¼ˆUserï¼‰
  â””â”€ åˆ›å»ºåˆ†ç±»ï¼ˆCategoryï¼‰
      â”œâ”€ åˆ›å»ºäº¤æ˜“å‘˜ï¼ˆTraderï¼‰
      â”‚   â””â”€ åˆ›å»ºäº¤æ˜“å‘˜è´¦å·ï¼ˆTrader Accountï¼Œå±äºè¯¥åˆ†ç±»ï¼‰
      â””â”€ åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆGroup Leaderï¼‰
          â””â”€ è§‚æµ‹æŒ‡å®šåˆ†ç±»ï¼ˆCategoryï¼‰
              â””â”€ æŸ¥çœ‹è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜

ç®¡ç†å‘˜ï¼ˆAdminï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
  â””â”€ å¯ä»¥ç®¡ç†æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼‰
      â””â”€ å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„è´¦å·
```

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… **æœ€å°åŒ–ä¿®æ”¹**ï¼šå°½å¯èƒ½å¤ç”¨ç°æœ‰ä»£ç 
- âœ… **éšè—/æ˜¾ç¤º**ï¼šä¸»è¦é€šè¿‡UIéšè—/æ˜¾ç¤ºæ“ä½œæŒ‰é’®å®ç°
- âœ… **åç«¯è¿‡æ»¤**ï¼šåç«¯APIæ ¹æ®è§’è‰²è¿‡æ»¤äº¤æ˜“å‘˜åˆ—è¡¨
- âœ… **å‰ç«¯å¤ç”¨**ï¼šäº¤æ˜“å‘˜åˆ‡æ¢ä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨æ ¹æ®APIè¿”å›çš„æ•°æ®æ˜¾ç¤ºï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

---

## âš ï¸ é‡è¦è¯´æ˜ï¼šAdmin Mode vs ç”¨æˆ·è§’è‰²

### ç°æœ‰ç³»ç»Ÿçš„ä¸¤ç§æ¨¡å¼

#### 1. Admin Modeï¼ˆç³»ç»Ÿçº§é…ç½®ï¼‰
- **ä½ç½®**ï¼š`config.json` ä¸­çš„ `admin_mode` å­—æ®µ
- **ç”¨é€”**ï¼šå•ç”¨æˆ·è‡ªæ‰˜ç®¡æ¨¡å¼
- **ç‰¹ç‚¹**ï¼š
  - `admin_mode=true` æ—¶ï¼šç¦ç”¨ç”¨æˆ·æ³¨å†Œï¼Œåªèƒ½é€šè¿‡ `/api/admin-login` ç™»å½•
  - ç™»å½•å `user_id` å›ºå®šä¸º `"admin"`ï¼Œ`email` ä¸º `"admin@localhost"`
  - è¿™æ˜¯ä¸€ä¸ª**ç³»ç»Ÿçº§åˆ«çš„å¼€å…³**ï¼Œç”¨äºæ§åˆ¶æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ¨¡å¼

#### 2. ç”¨æˆ·æ³¨å†Œï¼ˆå¤šç”¨æˆ·æ¨¡å¼ï¼‰
- **ä½ç½®**ï¼šæ•°æ®åº“ `users` è¡¨
- **ç”¨é€”**ï¼šå¤šç”¨æˆ·æ¨¡å¼ï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œ
- **ç‰¹ç‚¹**ï¼š
  - `admin_mode=false` æ—¶ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œ
  - æ³¨å†Œçš„ç”¨æˆ·éœ€è¦ OTP éªŒè¯
  - è¿™äº›ç”¨æˆ·æ˜¯çœŸæ­£çš„æ•°æ®åº“ç”¨æˆ·ï¼Œæœ‰è‡ªå·±çš„ `user_id` å’Œ `email`

### æˆ‘ä»¬çš„è®¾è®¡ï¼ˆä¸å†²çªï¼‰

**å…³é”®ç†è§£ï¼š**
- **Admin Mode** = ç³»ç»Ÿé…ç½®å¼€å…³ï¼ˆæ§åˆ¶æ˜¯å¦å…è®¸æ³¨å†Œï¼‰
- **ç”¨æˆ·è§’è‰²ï¼ˆroleï¼‰** = æ•°æ®åº“å­—æ®µï¼ˆæ§åˆ¶ç”¨æˆ·æƒé™ï¼‰

**ç”¨æˆ·è§’è‰²åˆ†é…ï¼š**
1. **é€šè¿‡æ³¨å†Œçš„ç”¨æˆ·** â†’ `role='user'`ï¼ˆéœ€è¦ OTP éªŒè¯ï¼‰
   - è¿™äº›ç”¨æˆ·åªèƒ½çœ‹åˆ°å’Œç®¡ç†**è‡ªå·±åˆ›å»ºçš„äº¤æ˜“å‘˜**
   - éœ€è¦ Google Authenticator éªŒè¯
   - ä¸èƒ½çœ‹åˆ°å…¶ä»–ç”¨æˆ·çš„äº¤æ˜“å‘˜
   - **å¯ä»¥åˆ›å»ºåˆ†ç±»**
   - **å¯ä»¥ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆtrader_accountï¼‰**
   - **å¯ä»¥ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆgroup_leaderï¼‰**

2. **çœŸæ­£çš„ç®¡ç†å‘˜** â†’ `role='admin'`ï¼ˆéœ€è¦ OTP éªŒè¯ï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
   - å¯ä»¥ç®¡ç†**æ‰€æœ‰äº¤æ˜“å‘˜**ï¼ˆè·¨ç”¨æˆ·ï¼‰
   - å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„è´¦å·ï¼ˆgroup_leader æˆ– trader_accountï¼‰
   - éœ€è¦ Google Authenticator éªŒè¯
   - é€šå¸¸ç”±ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®
   - **æ³¨æ„**ï¼šä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨æ­¤è§’è‰²ï¼Œé»˜è®¤ä½¿ç”¨Userè§’è‰²

3. **æ™®é€šç”¨æˆ·åˆ›å»ºçš„è´¦å·** â†’ `role='group_leader'` æˆ– `role='trader_account'`ï¼ˆä¸éœ€è¦ OTPï¼‰
   - è¿™äº›è´¦å·ç”±æ™®é€šç”¨æˆ·åˆ›å»º
   - ä¸éœ€è¦ OTP éªŒè¯ï¼Œç›´æ¥ç™»å½•
   - åªèƒ½æŸ¥çœ‹æ•°æ®ï¼Œä¸èƒ½é…ç½®
   - group_leader åªèƒ½æŸ¥çœ‹åˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»
   - trader_account åªèƒ½æŸ¥çœ‹å…³è”çš„äº¤æ˜“å‘˜

**å…¼å®¹æ€§ï¼š**
- âœ… ä¸å½±å“ç°æœ‰çš„ Admin Mode åŠŸèƒ½
- âœ… æ³¨å†Œçš„ç”¨æˆ·é»˜è®¤æ˜¯ `role='user'`ï¼ˆå¯ä»¥åˆ›å»ºåˆ†ç±»å’Œè´¦å·ï¼‰
- âœ… æ™®é€šç”¨æˆ·åˆ›å»ºçš„è´¦å·æ˜¯åªè¯»è§’è‰²ï¼ˆä¸éœ€è¦ OTPï¼‰
- âœ… å‘åå…¼å®¹ï¼šæ²¡æœ‰ `role` å­—æ®µçš„ç”¨æˆ·é»˜è®¤ä¸º `user`ï¼Œåªèƒ½çœ‹åˆ°è‡ªå·±çš„äº¤æ˜“å‘˜

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1. æ•°æ®åº“è®¾è®¡

#### 1.1 ç”¨æˆ·è¡¨æ‰©å±• (`users`)

```sql
-- æ·»åŠ è§’è‰²å­—æ®µ
ALTER TABLE users ADD COLUMN role TEXT DEFAULT 'user';
-- è§’è‰²å€¼: 'admin' | 'user' | 'group_leader' | 'trader_account'

-- æ·»åŠ å…³è”å­—æ®µ
ALTER TABLE users ADD COLUMN trader_id TEXT DEFAULT NULL;
-- å¦‚æœ role = 'trader_account'ï¼Œæ­¤å­—æ®µæŒ‡å‘å…³è”çš„äº¤æ˜“å‘˜ID
-- FOREIGN KEY (trader_id) REFERENCES traders(id)

ALTER TABLE users ADD COLUMN category TEXT DEFAULT NULL;
-- å¦‚æœ role = 'trader_account'ï¼Œæ­¤å­—æ®µå­˜å‚¨äº¤æ˜“å‘˜æ‰€å±çš„åˆ†ç±»ï¼ˆå†—ä½™å­—æ®µï¼Œæ–¹ä¾¿æŸ¥è¯¢ï¼‰
```

**è§’è‰²è¯´æ˜ï¼š**
- `admin`: çœŸæ­£çš„ç®¡ç†å‘˜ï¼Œå¯ä»¥ç®¡ç†**æ‰€æœ‰äº¤æ˜“å‘˜**ï¼ˆè·¨ç”¨æˆ·ï¼‰ã€åˆ†ç±»ã€åˆ›å»ºè´¦å·ã€é…ç½®æ‰€æœ‰å†…å®¹ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
  - **æ¥æº**ï¼šç”±ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®ï¼ˆé€šå¸¸ç¬¬ä¸€ä¸ªç”¨æˆ·æˆ–ç‰¹æ®Šç”¨æˆ·ï¼‰
  - **ç™»å½•**ï¼šéœ€è¦ OTP éªŒè¯ï¼ˆGoogle Authenticatorï¼‰
  - **æƒé™**ï¼šå®Œæ•´çš„ç®¡ç†æƒé™ï¼ˆå¯ä»¥çœ‹åˆ°æ‰€æœ‰ç”¨æˆ·çš„äº¤æ˜“å‘˜ï¼‰
  - **æ³¨æ„**ï¼šä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨æ­¤è§’è‰²ï¼Œé»˜è®¤ä½¿ç”¨Userè§’è‰²
- `user`: æ™®é€šç”¨æˆ·ï¼Œå¯ä»¥åˆ›å»ºåˆ†ç±»ï¼Œç®¡ç†**è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜**ï¼Œåˆ›å»ºè´¦å·
  - **æ¥æº**ï¼šé€šè¿‡æ³¨å†Œçš„ç”¨æˆ·ï¼ˆ`admin_mode=false` æ—¶ï¼‰
  - **ç™»å½•**ï¼šéœ€è¦ OTP éªŒè¯ï¼ˆGoogle Authenticatorï¼‰
  - **æƒé™**ï¼š
    - å¯ä»¥åˆ›å»ºåˆ†ç±»
    - å¯ä»¥åˆ›å»ºäº¤æ˜“å‘˜ï¼ˆå±äºæŸä¸ªåˆ†ç±»ï¼‰
    - åªèƒ½çœ‹åˆ°å’Œç®¡ç†è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜
    - **å¯ä»¥ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆtrader_accountï¼‰**
    - **å¯ä»¥ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆgroup_leaderï¼‰**
- `group_leader`: å°ç»„ç»„é•¿ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡å®šåˆ†ç±»çš„æ‰€æœ‰äº¤æ˜“å‘˜æ•°æ®ï¼Œä¸èƒ½é…ç½®
  - **æ¥æº**ï¼šç”±æ™®é€šç”¨æˆ·åˆ›å»º
  - **ç™»å½•**ï¼šä¸éœ€è¦ OTPï¼Œç›´æ¥ç™»å½•
  - **æƒé™**ï¼šåªè¯»æƒé™ï¼ˆæŸ¥çœ‹æŒ‡å®šåˆ†ç±»å†…çš„äº¤æ˜“å‘˜ï¼‰
  - **é™åˆ¶**ï¼šåªèƒ½æŸ¥çœ‹åˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼ˆä¸èƒ½è·¨ç”¨æˆ·æŸ¥çœ‹ï¼‰
- `trader_account`: äº¤æ˜“å‘˜è´¦å·ï¼Œåªèƒ½æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜æ•°æ®ï¼Œä¸èƒ½é…ç½®
  - **æ¥æº**ï¼šç”±æ™®é€šç”¨æˆ·åˆ›å»º
  - **ç™»å½•**ï¼šä¸éœ€è¦ OTPï¼Œç›´æ¥ç™»å½•
  - **æƒé™**ï¼šåªè¯»æƒé™ï¼ˆæŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰
  - **ä»å±å…³ç³»**ï¼šå±äºæŸä¸ªåˆ†ç±»

**æ³¨æ„ï¼š**
- `admin_mode` æ˜¯ç³»ç»Ÿçº§å¼€å…³ï¼ˆ`config.json`ï¼‰ï¼Œæ§åˆ¶æ˜¯å¦å…è®¸æ³¨å†Œ
- `role` æ˜¯ç”¨æˆ·çº§è§’è‰²ï¼ˆæ•°æ®åº“å­—æ®µï¼‰ï¼Œæ§åˆ¶ç”¨æˆ·æƒé™
- `role='user'` æ˜¯æ™®é€šæ³¨å†Œç”¨æˆ·ï¼Œå¯ä»¥åˆ›å»ºåˆ†ç±»å’Œç®¡ç†è‡ªå·±çš„äº¤æ˜“å‘˜
- ä¸¤è€…**ä¸å†²çª**ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨

#### 1.2 äº¤æ˜“å‘˜è¡¨æ‰©å±• (`traders`)

```sql
-- æ·»åŠ åˆ†ç±»å­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
ALTER TABLE traders ADD COLUMN category TEXT DEFAULT '';
-- äº¤æ˜“å‘˜åˆ†ç±»/ç»„åï¼Œç”¨äºåˆ†ç»„ç®¡ç†
-- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„categoryé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä¸å½±å“ç°æœ‰æ•°æ®

-- æ·»åŠ äº¤æ˜“å‘˜è´¦å·å…³è”å­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
ALTER TABLE traders ADD COLUMN trader_account_id TEXT DEFAULT NULL;
-- å…³è”çš„äº¤æ˜“å‘˜è´¦å·ç”¨æˆ·IDï¼ˆå¦‚æœæœ‰ï¼‰
-- FOREIGN KEY (trader_account_id) REFERENCES users(id)
-- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„trader_account_idé»˜è®¤ä¸ºNULLï¼Œä¸å½±å“ç°æœ‰æ•°æ®

-- æ·»åŠ æ‰€æœ‰è€…ç”¨æˆ·IDå­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
ALTER TABLE traders ADD COLUMN owner_user_id TEXT DEFAULT NULL;
-- åˆ›å»ºè¯¥äº¤æ˜“å‘˜çš„ç”¨æˆ·IDï¼Œç”¨äºæƒé™æ§åˆ¶
-- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„owner_user_idé»˜è®¤ä¸ºNULLï¼Œéœ€è¦æ•°æ®è¿ç§»æ—¶æ ¹æ®user_idå…³è”è®¾ç½®
```

#### 1.3 æ–°å¢è¡¨ï¼šå°ç»„ç»„é•¿åˆ†ç±»å…³è”è¡¨ (`group_leader_categories`)

```sql
CREATE TABLE IF NOT EXISTS group_leader_categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    group_leader_id TEXT NOT NULL,  -- å°ç»„ç»„é•¿ç”¨æˆ·ID
    category TEXT NOT NULL,          -- åˆ†ç±»åç§°
    owner_user_id TEXT NOT NULL,     -- åˆ†ç±»æ‰€æœ‰è€…ç”¨æˆ·IDï¼ˆåˆ›å»ºè¯¥åˆ†ç±»çš„ç”¨æˆ·ï¼‰
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (group_leader_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(group_leader_id, category)  -- é˜²æ­¢é‡å¤å…³ç³»
);

CREATE INDEX idx_group_leader ON group_leader_categories(group_leader_id);
CREATE INDEX idx_category ON group_leader_categories(category);
CREATE INDEX idx_owner_user ON group_leader_categories(owner_user_id);
```

**ç”¨é€”ï¼š**
- å»ºç«‹å°ç»„ç»„é•¿ä¸åˆ†ç±»çš„å…³è”å…³ç³»
- ä¸€ä¸ªå°ç»„ç»„é•¿å¯ä»¥è§‚æµ‹å¤šä¸ªåˆ†ç±»
- ä¸€ä¸ªåˆ†ç±»å¯ä»¥è¢«å¤šä¸ªå°ç»„ç»„é•¿è§‚æµ‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
- **owner_user_id ç¡®ä¿å°ç»„ç»„é•¿åªèƒ½æŸ¥çœ‹åˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼ˆæ•°æ®éš”ç¦»ï¼‰**
- åˆ†ç±»å¿…é¡»å±äºæŸä¸ªæ³¨å†Œç”¨æˆ·ï¼ˆé€šè¿‡ categories è¡¨å…³è”ï¼‰

---

## ğŸ” æƒé™æ§åˆ¶è®¾è®¡

### 2.1 æƒé™å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User (æ™®é€šç”¨æˆ·)                   â”‚
â”‚  - åˆ›å»ºåˆ†ç±»                               â”‚
â”‚  - åˆ›å»ºäº¤æ˜“å‘˜ï¼ˆå±äºæŸä¸ªåˆ†ç±»ï¼‰              â”‚
â”‚  - ç®¡ç†è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜                  â”‚
â”‚  - ä¸ºäº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆTrader Accountï¼‰     â”‚
â”‚  - ä¸ºåˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆGroup Leaderï¼‰  â”‚
â”‚  - é…ç½®è‡ªå·±çš„å†…å®¹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚
        â”‚ åˆ›å»ºåˆ†ç±»                â”‚ åˆ›å»ºè´¦å·
        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Category        â”‚  â”‚  Group Leader           â”‚
â”‚  (åˆ†ç±»)           â”‚  â”‚  (å°ç»„ç»„é•¿)              â”‚
â”‚  - å±äºæŸä¸ªUser   â”‚  â”‚  - è§‚æµ‹æŒ‡å®šåˆ†ç±»çš„äº¤æ˜“å‘˜  â”‚
â”‚  - åŒ…å«å¤šä¸ªäº¤æ˜“å‘˜  â”‚  â”‚  - ä¸èƒ½é…ç½®ï¼ˆåªè¯»ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚
        â”‚ åˆ›å»ºäº¤æ˜“å‘˜               â”‚ è§‚æµ‹
        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Trader          â”‚  â”‚  Trader Account         â”‚
â”‚  (äº¤æ˜“å‘˜)         â”‚  â”‚  (äº¤æ˜“å‘˜è´¦å·)            â”‚
â”‚  - å±äºæŸä¸ªåˆ†ç±»    â”‚  â”‚  - å±äºæŸä¸ªåˆ†ç±»          â”‚
â”‚  - å¯ä»¥åˆ›å»ºè´¦å·    â”‚  â”‚  - æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜æ•°æ® â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - ä¸èƒ½é…ç½®ï¼ˆåªè¯»ï¼‰      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®è®¿é—®è§„åˆ™

| æ“ä½œ | Admin | User | Group Leader | Trader Account |
|------|-------|------|--------------|----------------|
| æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼‰ | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹è‡ªå·±åˆ†ç±»çš„äº¤æ˜“å‘˜ | âœ… | âœ… | âŒ | âŒ |
| æŸ¥çœ‹æŒ‡å®šåˆ†ç±»çš„äº¤æ˜“å‘˜ | âœ… | âŒ | âœ…ï¼ˆåˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼‰ | âŒ |
| æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜ | âœ… | âœ… | âŒ | âœ… |
| åˆ›å»ºåˆ†ç±» | âœ… | âœ… | âŒ | âŒ |
| åˆ›å»ºäº¤æ˜“å‘˜ï¼ˆå±äºåˆ†ç±»ï¼‰ | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ | âŒ |
| ç¼–è¾‘/åˆ é™¤äº¤æ˜“å‘˜ | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ | âŒ |
| é…ç½®äº¤æ˜“å‘˜å‚æ•° | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ | âŒ |
| åˆ›å»ºäº¤æ˜“å‘˜è´¦å· | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰ | âŒ | âŒ |
| åˆ›å»ºå°ç»„ç»„é•¿è´¦å· | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ | âŒ |
| æŸ¥çœ‹äº¤æ˜“å‘˜è¯¦æƒ… | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âœ…ï¼ˆè§‚æµ‹çš„åˆ†ç±»ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„ï¼‰ |
| æŸ¥çœ‹ç»Ÿè®¡æ•°æ® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âœ…ï¼ˆè§‚æµ‹çš„åˆ†ç±»ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„ï¼‰ |

**æ³¨æ„ï¼š** Adminè§’è‰²ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨ï¼Œé»˜è®¤ä½¿ç”¨Userè§’è‰²ã€‚

### 2.3 UIåŠŸèƒ½æ˜¾ç¤ºè§„åˆ™

| åŠŸèƒ½æ¨¡å— | Admin | User | Group Leader | Trader Account |
|----------|-------|------|--------------|----------------|
| äº¤æ˜“å‘˜åˆ—è¡¨ | âœ… æ‰€æœ‰äº¤æ˜“å‘˜ | âœ… è‡ªå·±åˆ†ç±»çš„äº¤æ˜“å‘˜ | âœ… åªè¯»ï¼ˆè§‚æµ‹çš„åˆ†ç±»ï¼‰ | âœ… åªè¯»ï¼ˆè‡ªå·±çš„ï¼‰ |
| åˆ›å»ºåˆ†ç±»æŒ‰é’® | âœ… | âœ… | âŒ éšè— | âŒ éšè— |
| åˆ›å»ºäº¤æ˜“å‘˜æŒ‰é’® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| ç¼–è¾‘äº¤æ˜“å‘˜æŒ‰é’® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| åˆ é™¤äº¤æ˜“å‘˜æŒ‰é’® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| AIæ¨¡å‹é…ç½® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| äº¤æ˜“æ‰€é…ç½® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| ä¿¡å·æºé…ç½® | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| åˆ†ç±»ç®¡ç† | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„ï¼‰ | âŒ éšè— | âŒ éšè— |
| åˆ›å»ºäº¤æ˜“å‘˜è´¦å· | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰ | âŒ éšè— | âŒ éšè— |
| åˆ›å»ºå°ç»„ç»„é•¿è´¦å· | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âŒ éšè— | âŒ éšè— |
| äº¤æ˜“å‘˜è¯¦æƒ…é¡µ | âœ… å®Œæ•´ï¼ˆæ‰€æœ‰ï¼‰ | âœ… å®Œæ•´ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰ | âœ… åªè¯» | âœ… åªè¯» |

**æ³¨æ„ï¼š** Adminè§’è‰²ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨ï¼Œé»˜è®¤ä½¿ç”¨Userè§’è‰²ã€‚

---

## ğŸ“Š API è®¾è®¡ï¼ˆæœ€å°åŒ–ä¿®æ”¹ï¼‰

### 3.1 ç”¨æˆ·ä¿¡æ¯æ¥å£æ‰©å±•

#### GET `/api/account` (ä¿®æ”¹ç°æœ‰æ¥å£)
**ä¿®æ”¹ä½ç½®ï¼š** `api/server.go` - `handleAccount` å‡½æ•°

**å“åº”æ‰©å±•ï¼š**
```json
{
  "id": "user123",
  "email": "user@example.com",
  "role": "admin",  // æ–°å¢ï¼šç”¨æˆ·è§’è‰²
  "trader_id": null,  // æ–°å¢ï¼šå¦‚æœæ˜¯äº¤æ˜“å‘˜è´¦å·ï¼Œå…³è”çš„äº¤æ˜“å‘˜ID
  "categories": []  // æ–°å¢ï¼šå¦‚æœæ˜¯å°ç»„ç»„é•¿ï¼Œç®¡ç†çš„åˆ†ç±»åˆ—è¡¨
}
```

**ä¿®æ”¹æ–¹å¼ï¼š**
- åœ¨è¿”å›è´¦æˆ·ä¿¡æ¯æ—¶ï¼Œä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·è§’è‰²å’Œå…³è”ä¿¡æ¯
- æ·»åŠ åˆ°å“åº”JSONä¸­

### 3.2 äº¤æ˜“å‘˜åˆ—è¡¨æ¥å£ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼‰

#### GET `/api/my-traders` (ä¿®æ”¹ç°æœ‰æ¥å£)
**ä¿®æ”¹ä½ç½®ï¼š** `api/server.go:1096` - `handleTraderList` å‡½æ•°

**æƒé™æ§åˆ¶é€»è¾‘ï¼š**
```go
// ä¼ªä»£ç ç¤ºä¾‹
func (s *Server) handleTraderList(c *gin.Context) {
    userID := c.GetString("user_id")
    
    // 1. è·å–ç”¨æˆ·è§’è‰²å’Œæƒé™ä¿¡æ¯
    user, _ := s.database.GetUserByID(userID)
    role := user.Role // "admin" | "group_leader" | "trader_account"
    
    var traders []*TraderRecord
    
    // 2. æ ¹æ®è§’è‰²è¿‡æ»¤äº¤æ˜“å‘˜åˆ—è¡¨
    switch role {
    case "admin":
        // ç®¡ç†å‘˜ï¼šè¿”å›æ‰€æœ‰äº¤æ˜“å‘˜
        traders, _ = s.database.GetAllTraders()
    case "group_leader":
        // å°ç»„ç»„é•¿ï¼šè¿”å›ç®¡ç†çš„åˆ†ç±»å†…çš„äº¤æ˜“å‘˜
        categories := s.database.GetGroupLeaderCategories(userID)
        traders, _ = s.database.GetTradersByCategories(categories)
    case "trader_account":
        // äº¤æ˜“å‘˜è´¦å·ï¼šåªè¿”å›è‡ªå·±çš„äº¤æ˜“å‘˜
        traders, _ = s.database.GetTradersByID(user.TraderID)
    default:
        // é»˜è®¤ï¼šè¿”å›ç”¨æˆ·è‡ªå·±çš„äº¤æ˜“å‘˜ï¼ˆå‘åå…¼å®¹ï¼‰
        traders, _ = s.database.GetTraders(userID)
    }
    
    // 3. è¿”å›ç»“æœï¼ˆä¿æŒç°æœ‰æ ¼å¼ï¼Œæ— éœ€ä¿®æ”¹å‰ç«¯ï¼‰
    // ... ç°æœ‰ä»£ç  ...
}
```

**å“åº”æ ¼å¼ï¼š**ï¼ˆä¿æŒç°æœ‰æ ¼å¼ä¸å˜ï¼‰
```json
[
  {
    "trader_id": "trader123",
    "trader_name": "Trader 1",
    "ai_model": "deepseek",
    "exchange_id": "binance",
    "is_running": true,
    "initial_balance": 1000.0
  }
]
```

**å…³é”®ç‚¹ï¼š**
- âœ… **å“åº”æ ¼å¼ä¸å˜**ï¼šå‰ç«¯æ— éœ€ä¿®æ”¹
- âœ… **åç«¯è¿‡æ»¤**ï¼šæ ¹æ®è§’è‰²åœ¨æ•°æ®åº“æŸ¥è¯¢æ—¶è¿‡æ»¤
- âœ… **äº¤æ˜“å‘˜ä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨é€‚é…**ï¼šå‰ç«¯ä¸‹æ‹‰åˆ—è¡¨ä½¿ç”¨ `traders` æ•°ç»„ï¼Œè‡ªåŠ¨åªæ˜¾ç¤ºæœ‰æƒé™çš„äº¤æ˜“å‘˜

### 3.3 äº¤æ˜“å‘˜è¯¦æƒ…æ¥å£

#### GET `/api/traders/:id`
**æƒé™æ§åˆ¶ï¼š**
- **Admin**: å¯ä»¥æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“å‘˜è¯¦æƒ…ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- **User**: åªèƒ½æŸ¥çœ‹è‡ªå·±åˆ†ç±»å†…çš„äº¤æ˜“å‘˜è¯¦æƒ…ï¼ˆæˆ–owner_user_idä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰
- **Group Leader**: åªèƒ½æŸ¥çœ‹ç®¡ç†çš„åˆ†ç±»å†…çš„äº¤æ˜“å‘˜è¯¦æƒ…ï¼ˆåˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼‰
- **Trader Account**: åªèƒ½æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜è¯¦æƒ…

**æƒé™æ£€æŸ¥å®ç°ï¼š**
```go
func (s *Server) handleTraderDetails(c *gin.Context) {
    userID := c.GetString("user_id")
    traderID := c.Param("id")
    
    // è·å–ç”¨æˆ·è§’è‰²
    user, err := s.database.GetUserByID(userID)
    if err != nil {
        c.JSON(http.StatusUnauthorized, gin.H{"error": "ç”¨æˆ·ä¸å­˜åœ¨"})
        return
    }
    
    role := user.Role
    if role == "" {
        role = "user" // é»˜è®¤æ˜¯æ™®é€šç”¨æˆ·
    }
    
    // è·å–äº¤æ˜“å‘˜ä¿¡æ¯
    trader, err := s.database.GetTraderByID(traderID)
    if err != nil || trader == nil {
        c.JSON(http.StatusNotFound, gin.H{"error": "äº¤æ˜“å‘˜ä¸å­˜åœ¨"})
        return
    }
    
    // æƒé™æ£€æŸ¥
    canAccess := false
    switch role {
    case "admin":
        // ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰äº¤æ˜“å‘˜
        canAccess = true
    case "user":
        // æ™®é€šç”¨æˆ·ï¼šæ£€æŸ¥owner_user_idæˆ–åˆ†ç±»æƒé™
        if trader.OwnerUserID == userID {
            canAccess = true
        } else if trader.Category != "" {
            // æ£€æŸ¥åˆ†ç±»æ˜¯å¦å±äºè¯¥ç”¨æˆ·
            category, _ := s.database.GetCategoryByName(trader.Category)
            if category != nil && category.OwnerUserID == userID {
                canAccess = true
            }
        }
    case "group_leader":
        // å°ç»„ç»„é•¿ï¼šæ£€æŸ¥äº¤æ˜“å‘˜æ˜¯å¦åœ¨ç®¡ç†çš„åˆ†ç±»å†…
        if trader.Category != "" {
            categories := s.database.GetGroupLeaderCategories(userID)
            for _, cat := range categories {
                if cat == trader.Category {
                    canAccess = true
                    break
                }
            }
        }
    case "trader_account":
        // äº¤æ˜“å‘˜è´¦å·ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå·±çš„äº¤æ˜“å‘˜
        if user.TraderID == traderID {
            canAccess = true
        }
    }
    
    if !canAccess {
        c.JSON(http.StatusForbidden, gin.H{"error": "æ— æƒè®¿é—®è¯¥äº¤æ˜“å‘˜"})
        return
    }
    
    // è¿”å›äº¤æ˜“å‘˜è¯¦æƒ…ï¼ˆç°æœ‰é€»è¾‘ï¼‰
    // ...
}
```

**å“åº”æ ¼å¼ï¼š**ï¼ˆä¿æŒä¸å˜ï¼Œä½†å¢åŠ æƒé™æ£€æŸ¥ï¼‰

### 3.3.1 åˆ›å»ºäº¤æ˜“å‘˜æ¥å£ï¼ˆä¿®æ”¹ç°æœ‰æ¥å£ï¼‰

#### POST `/api/traders` (ä¿®æ”¹ç°æœ‰æ¥å£)
**ä¿®æ”¹ä½ç½®ï¼š** `api/server.go` - `handleCreateTrader` å‡½æ•°

**ä¿®æ”¹å†…å®¹ï¼š** åˆ›å»ºäº¤æ˜“å‘˜æ—¶è®¾ç½® `owner_user_id` å’Œ `category`

**è¯·æ±‚ä½“æ‰©å±•ï¼š**
```json
{
  "name": "Trader 1",
  "ai_model_id": "deepseek",
  "exchange_id": "binance",
  "initial_balance": 1000.0,
  "category": "Group A"  // æ–°å¢ï¼šå¯é€‰ï¼Œåˆ†ç±»åç§°ï¼ˆå¦‚æœæä¾›ï¼Œå¿…é¡»å±äºå½“å‰ç”¨æˆ·ï¼‰
}
```

**å®ç°é€»è¾‘ï¼š**
```go
func (s *Server) handleCreateTrader(c *gin.Context) {
    userID := c.GetString("user_id")
    var req CreateTraderRequest
    
    // ... ç°æœ‰éªŒè¯é€»è¾‘ ...
    
    // åˆ›å»ºäº¤æ˜“å‘˜é…ç½®
    trader := &config.TraderRecord{
        ID:            traderID,
        UserID:        userID,
        OwnerUserID:   userID,  // æ–°å¢ï¼šè®¾ç½®ä¸ºå½“å‰ç”¨æˆ·ID
        Category:      "",      // æ–°å¢ï¼šé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²
        Name:          req.Name,
        AIModelID:     req.AIModelID,
        ExchangeID:    req.ExchangeID,
        InitialBalance: actualBalance,
        // ... å…¶ä»–å­—æ®µ ...
    }
    
    // å¦‚æœæä¾›äº†categoryï¼ŒéªŒè¯å¹¶è®¾ç½®
    if req.Category != "" {
        // éªŒè¯åˆ†ç±»æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
        category, err := s.database.GetCategoryByName(req.Category)
        if err != nil || category == nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": "åˆ†ç±»ä¸å­˜åœ¨"})
            return
        }
        if category.OwnerUserID != userID {
            c.JSON(http.StatusForbidden, gin.H{"error": "åªèƒ½ä½¿ç”¨è‡ªå·±çš„åˆ†ç±»"})
            return
        }
        trader.Category = req.Category
    }
    
    // ä¿å­˜åˆ°æ•°æ®åº“
    err = s.database.CreateTrader(trader)
    // ... åç»­é€»è¾‘ ...
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… `owner_user_id` è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·ID
- âœ… `category` é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¯é€‰è®¾ç½®
- âœ… å¦‚æœæä¾›categoryï¼Œå¿…é¡»éªŒè¯å±äºå½“å‰ç”¨æˆ·
- âœ… äº¤æ˜“å‘˜å’Œåˆ†ç±»ç‹¬ç«‹ï¼šäº¤æ˜“å‘˜å¯ä»¥ä¸å±äºä»»ä½•åˆ†ç±»ï¼Œåˆ†ç±»åˆ é™¤ä¸å½±å“äº¤æ˜“å‘˜

### 3.4 ç™»å½•æ¥å£ä¿®æ”¹ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼‰

#### POST `/api/login` (ä¿®æ”¹ç°æœ‰æ¥å£)
**ä¿®æ”¹ä½ç½®ï¼š** `api/server.go:1732` - `handleLogin` å‡½æ•°

**ä¿®æ”¹é€»è¾‘ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²å†³å®šæ˜¯å¦éœ€è¦OTPéªŒè¯**

```go
func (s *Server) handleLogin(c *gin.Context) {
    var req struct {
        Email    string `json:"email" binding:"required,email"`
        Password string `json:"password" binding:"required"`
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    user, err := s.database.GetUserByEmail(req.Email)
    if err != nil {
        c.JSON(http.StatusUnauthorized, gin.H{"error": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"})
        return
    }
    
    // éªŒè¯å¯†ç 
    if !auth.CheckPassword(req.Password, user.PasswordHash) {
        c.JSON(http.StatusUnauthorized, gin.H{"error": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"})
        return
    }
    
    // è·å–ç”¨æˆ·è§’è‰²ï¼ˆé»˜è®¤ä¸ºuserï¼Œå‘åå…¼å®¹ï¼‰
    role := user.Role
    if role == "" {
        role = "user"  // é»˜è®¤æ˜¯æ™®é€šç”¨æˆ·
    }
    
    // æ ¹æ®è§’è‰²å†³å®šæ˜¯å¦éœ€è¦OTPéªŒè¯
    if role == "admin" || role == "user" {
        // ç®¡ç†å‘˜æˆ–æ™®é€šç”¨æˆ·ï¼ˆæ³¨å†Œç”¨æˆ·ï¼‰ï¼šéœ€è¦OTPéªŒè¯
        if !user.OTPVerified {
            c.JSON(http.StatusUnauthorized, gin.H{
                "error":              "è´¦æˆ·æœªå®ŒæˆOTPè®¾ç½®",
                "user_id":            user.ID,
                "requires_otp_setup": true,
            })
            return
        }
        
        // è¿”å›éœ€è¦OTPéªŒè¯çš„çŠ¶æ€
        c.JSON(http.StatusOK, gin.H{
            "user_id":      user.ID,
            "email":        user.Email,
            "message":      "è¯·è¾“å…¥Google AuthenticatoréªŒè¯ç ",
            "requires_otp": true,
        })
        return
    } else {
        // åˆ›å»ºçš„è´¦å·ï¼ˆgroup_leader æˆ– trader_accountï¼‰ï¼šä¸éœ€è¦OTPï¼Œç›´æ¥ç™»å½•
        // è¿™äº›è´¦å·ç”±æ™®é€šç”¨æˆ·åˆ›å»ºï¼Œä¸éœ€è¦OTPéªŒè¯
        token, err := auth.GenerateJWT(user.ID, user.Email)
        if err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{"error": "ç”Ÿæˆtokenå¤±è´¥"})
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "token":   token,
            "user_id": user.ID,
            "email":   user.Email,
            "role":    role,
            "message": "ç™»å½•æˆåŠŸ",
        })
        return
    }
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… **éšæ€§åˆ¤æ–­**ï¼šç™»å½•é¡µé¢çœ‹èµ·æ¥ä¸€æ ·ï¼Œåç«¯è‡ªåŠ¨åˆ¤æ–­è§’è‰²
- âœ… **æ³¨å†Œç”¨æˆ·éœ€è¦OTP**ï¼šé€šè¿‡æ³¨å†Œçš„ç”¨æˆ·ï¼ˆrole='admin' æˆ– 'user'ï¼‰éœ€è¦OTPéªŒè¯
- âœ… **åˆ›å»ºçš„è´¦å·ç›´æ¥ç™»å½•**ï¼šæ™®é€šç”¨æˆ·åˆ›å»ºçš„è´¦å·ï¼ˆrole='group_leader' æˆ– 'trader_account'ï¼‰è·³è¿‡OTP
- âœ… **å‘åå…¼å®¹**ï¼šæ²¡æœ‰roleå­—æ®µçš„ç”¨æˆ·é»˜è®¤ä¸ºuserï¼Œåªèƒ½çœ‹åˆ°è‡ªå·±çš„äº¤æ˜“å‘˜
- âœ… **ä¸å†²çªAdmin Mode**ï¼šAdmin Modeæ˜¯ç³»ç»Ÿå¼€å…³ï¼Œroleæ˜¯ç”¨æˆ·æƒé™ï¼Œä¸¤è€…ç‹¬ç«‹å·¥ä½œ
- âœ… **æ•°æ®éš”ç¦»**ï¼šæ™®é€šç”¨æˆ·ï¼ˆrole='user'ï¼‰åªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„äº¤æ˜“å‘˜ï¼Œä¸ä¼šå½±å“å…¶ä»–ç”¨æˆ·
- âœ… **Adminè§’è‰²ä¿ç•™**ï¼šAdminè§’è‰²ä¿ç•™ä½†ä¸å¸¸ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨Userè§’è‰²

### 3.5 åˆ›å»ºäº¤æ˜“å‘˜è´¦å·æ¥å£ï¼ˆæ–°å¢ï¼‰

#### POST `/api/traders/:id/create-account` (æ–°å¢)
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ›å»ºæ‰€æœ‰äº¤æ˜“å‘˜çš„è´¦å·ï¼ŒUseråªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼‰

**åŠŸèƒ½ï¼š** ä¸ºäº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆtrader_accountï¼‰

**è¯·æ±‚ä½“ï¼š**
```json
{
  "generate_random_email": true,    // true=è´¦å·éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥è´¦å·
  "generate_random_password": true, // true=å¯†ç éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥å¯†ç 
  "email": "user@example.com",      // å¦‚æœgenerate_random_email=falseï¼Œå¿…å¡«
  "password": "password123"         // å¦‚æœgenerate_random_password=falseï¼Œå¿…å¡«
}
```

**å››ç§ç»„åˆæ¨¡å¼ï¼š**
1. **è´¦å·éšæœºï¼Œå¯†ç è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=true, generate_random_password=false, passwordå¿…å¡«`
2. **å¯†ç éšæœºï¼Œè´¦å·è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=true, emailå¿…å¡«`
3. **å…¨éšæœº**ï¼š`generate_random_email=true, generate_random_password=true`
4. **å…¨è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=false, emailå’Œpasswordå¿…å¡«`

**æ³¨æ„ï¼š**
- Adminå¯ä»¥ä¸ºæ‰€æœ‰äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- æ™®é€šç”¨æˆ·åªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·
- éœ€è¦éªŒè¯äº¤æ˜“å‘˜çš„owner_user_idä¸å½“å‰ç”¨æˆ·IDåŒ¹é…ï¼ˆAdminè·³è¿‡æ­¤æ£€æŸ¥ï¼‰
- **äº¤æ˜“å‘˜è´¦å·è‡ªåŠ¨ç»§æ‰¿äº¤æ˜“å‘˜çš„åˆ†ç±»**ï¼š
  - å¦‚æœäº¤æ˜“å‘˜çš„ `category` ä¸ä¸ºç©ºï¼Œäº¤æ˜“å‘˜è´¦å·çš„ `category` è®¾ç½®ä¸ºç›¸åŒçš„å€¼
  - å¦‚æœäº¤æ˜“å‘˜çš„ `category` ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œäº¤æ˜“å‘˜è´¦å·çš„ `category` ä¹Ÿè®¾ä¸ºç©ºå­—ç¬¦ä¸²
  - **äº¤æ˜“å‘˜è´¦å·å¯ä»¥åˆ›å»ºï¼Œä¸å—åˆ†ç±»é™åˆ¶**ï¼ˆå³ä½¿äº¤æ˜“å‘˜æ²¡æœ‰åˆ†ç±»ä¹Ÿå¯ä»¥åˆ›å»ºè´¦å·ï¼‰
- å¦‚æœéšæœºç”Ÿæˆï¼Œè¿”å›çš„å“åº”ä¸­ä¼šåŒ…å«ç”Ÿæˆçš„è´¦å·å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰

#### POST `/api/group-leaders/create` (æ–°å¢)
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ›å»ºæ‰€æœ‰åˆ†ç±»çš„å°ç»„ç»„é•¿è´¦å·ï¼ŒUseråªèƒ½ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼‰

**åŠŸèƒ½ï¼š** åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆAdminå¯ä»¥åˆ›å»ºæ‰€æœ‰åˆ†ç±»çš„å°ç»„ç»„é•¿è´¦å·ï¼ŒUseråªèƒ½æŒ‡å®šè‡ªå·±åˆ›å»ºçš„åˆ†ç±»ï¼‰

**è¯·æ±‚ä½“ï¼š**
```json
{
  "generate_random_email": true,    // true=è´¦å·éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥è´¦å·
  "generate_random_password": true, // true=å¯†ç éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥å¯†ç 
  "email": "leader@example.com",   // å¦‚æœgenerate_random_email=falseï¼Œå¿…å¡«
  "password": "password123",        // å¦‚æœgenerate_random_password=falseï¼Œå¿…å¡«
  "categories": ["Group A", "Group B"]  // å¿…å¡«ï¼šå¯ä»¥è§‚æµ‹çš„åˆ†ç±»åˆ—è¡¨
}
```

**å››ç§ç»„åˆæ¨¡å¼ï¼š**
1. **è´¦å·éšæœºï¼Œå¯†ç è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=true, generate_random_password=false, passwordå¿…å¡«`
2. **å¯†ç éšæœºï¼Œè´¦å·è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=true, emailå¿…å¡«`
3. **å…¨éšæœº**ï¼š`generate_random_email=true, generate_random_password=true`
4. **å…¨è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=false, emailå’Œpasswordå¿…å¡«`

**å“åº”ï¼š**
```json
{
  "user_id": "trader_account_123",
  "email": "trader1@example.com",  // æœ€ç»ˆä½¿ç”¨çš„è´¦å·ï¼ˆéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥ï¼‰
  "password": "random_password_abc123",  // æœ€ç»ˆä½¿ç”¨çš„å¯†ç ï¼ˆéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥ï¼Œä»…æ­¤ä¸€æ¬¡è¿”å›ï¼‰
  "role": "trader_account",
  "trader_id": "trader123",  // å¦‚æœrole=trader_account
  "categories": []  // å¦‚æœrole=group_leader
}
```

**å“åº”è¯´æ˜ï¼š**
- `email` å’Œ `password` å­—æ®µå§‹ç»ˆè¿”å›ï¼Œæ— è®ºæ˜¯å¦éšæœºç”Ÿæˆ
- å¦‚æœéšæœºç”Ÿæˆï¼Œè¿”å›ç”Ÿæˆçš„è´¦å·å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼Œéœ€è¦ç”¨æˆ·ä¿å­˜ï¼‰
- å¦‚æœæ‰‹åŠ¨è¾“å…¥ï¼Œè¿”å›ç”¨æˆ·è¾“å…¥çš„è´¦å·å’Œå¯†ç ï¼ˆç¡®è®¤ä¿¡æ¯ï¼‰
- å‰ç«¯éœ€è¦æ˜¾ç¤ºè¿™äº›ä¿¡æ¯å¹¶æç¤ºç”¨æˆ·ä¿å­˜ï¼ˆç‰¹åˆ«æ˜¯éšæœºç”Ÿæˆçš„æƒ…å†µï¼‰

**å®ç°é€»è¾‘ï¼š**
```go
func (s *Server) handleCreateTraderAccount(c *gin.Context) {
    userID := c.GetString("user_id")
    traderID := c.Param("id")
    
    // æ£€æŸ¥ç”¨æˆ·è§’è‰²ï¼ˆå¿…é¡»æ˜¯adminæˆ–userï¼‰
    user, _ := s.database.GetUserByID(userID)
    if user.Role != "admin" && user.Role != "user" {
        c.JSON(http.StatusForbidden, gin.H{"error": "æƒé™ä¸è¶³"})
        return
    }
    
    // éªŒè¯äº¤æ˜“å‘˜æ˜¯å¦å­˜åœ¨
    trader, _ := s.database.GetTraderByID(traderID)
    if trader == nil {
        c.JSON(http.StatusNotFound, gin.H{"error": "äº¤æ˜“å‘˜ä¸å­˜åœ¨"})
        return
    }
    
    // å¦‚æœä¸æ˜¯adminï¼ŒéªŒè¯äº¤æ˜“å‘˜æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    if user.Role != "admin" && trader.OwnerUserID != userID {
        c.JSON(http.StatusForbidden, gin.H{"error": "åªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·"})
        return
    }
    
    var req struct {
        GenerateRandomEmail    bool   `json:"generate_random_email"`
        GenerateRandomPassword bool   `json:"generate_random_password"`
        Email                  string `json:"email"`
        Password               string `json:"password"`
    }
    
    // éªŒè¯å¿…å¡«å­—æ®µ
    if !req.GenerateRandomEmail && req.Email == "" {
        c.JSON(http.StatusBadRequest, gin.H{"error": "è´¦å·æœªé€‰æ‹©éšæœºç”Ÿæˆæ—¶ï¼Œå¿…é¡»æä¾›email"})
        return
    }
    if !req.GenerateRandomPassword && req.Password == "" {
        c.JSON(http.StatusBadRequest, gin.H{"error": "å¯†ç æœªé€‰æ‹©éšæœºç”Ÿæˆæ—¶ï¼Œå¿…é¡»æä¾›password"})
        return
    }
    
    // æ ¹æ®å››ç§ç»„åˆæ¨¡å¼ç”Ÿæˆè´¦å·ä¿¡æ¯
    var accountEmail, accountPassword string
    
    // 1. è´¦å·å¤„ç†ï¼šéšæœºç”Ÿæˆæˆ–ä½¿ç”¨è¾“å…¥çš„
    if req.GenerateRandomEmail {
        accountEmail = generateRandomEmail()
    } else {
        accountEmail = req.Email
    }
    
    // 2. å¯†ç å¤„ç†ï¼šéšæœºç”Ÿæˆæˆ–ä½¿ç”¨è¾“å…¥çš„
    if req.GenerateRandomPassword {
        accountPassword = generateRandomPassword(12)  // 12ä½éšæœºå¯†ç 
    } else {
        accountPassword = req.Password
    }
    
    // åˆ›å»ºç”¨æˆ·ï¼ˆtrader_accountè§’è‰²ï¼‰
    passwordHash, _ := auth.HashPassword(accountPassword)
    newUserID := uuid.New().String()
    
    newUser := &config.User{
        ID:           newUserID,
        Email:        accountEmail,
        PasswordHash: passwordHash,
        Role:         "trader_account",
        TraderID:     traderID,
        Category:     trader.Category,  // è‡ªåŠ¨ç»§æ‰¿äº¤æ˜“å‘˜çš„åˆ†ç±»ï¼ˆå¦‚æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä¹Ÿè®¾ä¸ºç©ºï¼‰
        OTPSecret:    "",  // ä¸éœ€è¦OTP
        OTPVerified:  true, // ç›´æ¥è®¾ç½®ä¸ºå·²éªŒè¯ï¼ˆè·³è¿‡OTPï¼‰
    }
    
    // æ³¨æ„ï¼šå¦‚æœäº¤æ˜“å‘˜çš„categoryä¸ºç©ºå­—ç¬¦ä¸²ï¼Œäº¤æ˜“å‘˜è´¦å·çš„categoryä¹Ÿè®¾ä¸ºç©ºå­—ç¬¦ä¸²
    // äº¤æ˜“å‘˜è´¦å·å¯ä»¥åˆ›å»ºï¼Œä¸å—åˆ†ç±»é™åˆ¶
    
    s.database.CreateUser(newUser)
    
    // æ›´æ–°äº¤æ˜“å‘˜çš„trader_account_id
    s.database.UpdateTraderAccountID(traderID, newUserID)
    
    c.JSON(http.StatusOK, gin.H{
        "user_id":  newUserID,
        "email":    accountEmail,
        "password": accountPassword,  // è¿”å›å¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
        "role":     "trader_account",
        "trader_id": traderID,
    })
}

func (s *Server) handleCreateGroupLeader(c *gin.Context) {
    userID := c.GetString("user_id")
    
    // æ£€æŸ¥ç”¨æˆ·è§’è‰²ï¼ˆå¿…é¡»æ˜¯adminæˆ–userï¼‰
    user, _ := s.database.GetUserByID(userID)
    if user.Role != "admin" && user.Role != "user" {
        c.JSON(http.StatusForbidden, gin.H{"error": "æƒé™ä¸è¶³"})
        return
    }
    
    var req struct {
        GenerateRandomEmail    bool     `json:"generate_random_email"`
        GenerateRandomPassword bool     `json:"generate_random_password"`
        Email                  string   `json:"email"`
        Password               string   `json:"password"`
        Categories             []string `json:"categories" binding:"required"`  // å¿…å¡«ï¼šå¯ä»¥è§‚æµ‹çš„åˆ†ç±»åˆ—è¡¨
    }
    
    // éªŒè¯å¿…å¡«å­—æ®µ
    if !req.GenerateRandomEmail && req.Email == "" {
        c.JSON(http.StatusBadRequest, gin.H{"error": "è´¦å·æœªé€‰æ‹©éšæœºç”Ÿæˆæ—¶ï¼Œå¿…é¡»æä¾›email"})
        return
    }
    if !req.GenerateRandomPassword && req.Password == "" {
        c.JSON(http.StatusBadRequest, gin.H{"error": "å¯†ç æœªé€‰æ‹©éšæœºç”Ÿæˆæ—¶ï¼Œå¿…é¡»æä¾›password"})
        return
    }
    
    // å¦‚æœä¸æ˜¯adminï¼ŒéªŒè¯åˆ†ç±»æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    if user.Role != "admin" {
        userCategories := s.database.GetUserCategories(userID)
        for _, cat := range req.Categories {
            if !contains(userCategories, cat) {
                c.JSON(http.StatusForbidden, gin.H{"error": "åªèƒ½ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿"})
                return
            }
        }
    }
    
    // æ ¹æ®å››ç§ç»„åˆæ¨¡å¼ç”Ÿæˆè´¦å·ä¿¡æ¯
    var accountEmail, accountPassword string
    
    // 1. è´¦å·å¤„ç†ï¼šéšæœºç”Ÿæˆæˆ–ä½¿ç”¨è¾“å…¥çš„
    if req.GenerateRandomEmail {
        accountEmail = generateRandomEmail()
    } else {
        accountEmail = req.Email
    }
    
    // 2. å¯†ç å¤„ç†ï¼šéšæœºç”Ÿæˆæˆ–ä½¿ç”¨è¾“å…¥çš„
    if req.GenerateRandomPassword {
        accountPassword = generateRandomPassword(12)  // 12ä½éšæœºå¯†ç 
    } else {
        accountPassword = req.Password
    }
    
    // åˆ›å»ºç”¨æˆ·ï¼ˆgroup_leaderè§’è‰²ï¼‰
    passwordHash, _ := auth.HashPassword(accountPassword)
    newUserID := uuid.New().String()
    
    newUser := &config.User{
        ID:           newUserID,
        Email:        accountEmail,
        PasswordHash: passwordHash,
        Role:         "group_leader",
        OTPSecret:    "",  // ä¸éœ€è¦OTP
        OTPVerified:  true, // ç›´æ¥è®¾ç½®ä¸ºå·²éªŒè¯ï¼ˆè·³è¿‡OTPï¼‰
    }
    
    s.database.CreateUser(newUser)
    
    // å…³è”åˆ†ç±»ï¼ˆgroup_leader_categoriesè¡¨ï¼‰
    // æ³¨æ„ï¼šowner_user_idå¿…é¡»è®¾ç½®ä¸ºåˆ›å»ºè€…çš„ç”¨æˆ·IDï¼Œç¡®ä¿æ•°æ®éš”ç¦»
    for _, cat := range req.Categories {
        err := s.database.InsertGroupLeaderCategory(newUserID, cat, userID)  // ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯owner_user_id
        if err != nil {
            // å¦‚æœå…³è”å¤±è´¥ï¼Œå›æ»šç”¨æˆ·åˆ›å»º
            s.database.DeleteUser(newUserID)
            c.JSON(http.StatusInternalServerError, gin.H{"error": "åˆ›å»ºå°ç»„ç»„é•¿å¤±è´¥"})
            return
        }
    }
    
    c.JSON(http.StatusOK, gin.H{
        "user_id":   newUserID,
        "email":     accountEmail,
        "password":  accountPassword,  // è¿”å›å¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
        "role":      "group_leader",
        "categories": req.Categories,
    })
}
```

### 3.6 æ³¨å†Œæ¥å£ä¿®æ”¹ï¼ˆé‡è¦ï¼‰

#### POST `/api/register` (ä¿®æ”¹ç°æœ‰æ¥å£)
**ä¿®æ”¹ä½ç½®ï¼š** `api/server.go:1572` - `handleRegister` å‡½æ•°

**ä¿®æ”¹å†…å®¹ï¼š** æ³¨å†Œæ—¶è®¾ç½® `role='user'`

```go
// åœ¨ handleRegister å‡½æ•°ä¸­ï¼Œåˆ›å»ºç”¨æˆ·æ—¶è®¾ç½®role
user := &config.User{
    ID:           userID,
    Email:        req.Email,
    PasswordHash: passwordHash,
    OTPSecret:    otpSecret,
    OTPVerified:  false,
    Role:         "user",  // æ³¨å†Œçš„ç”¨æˆ·é»˜è®¤æ˜¯userè§’è‰²ï¼ˆåªèƒ½ç®¡ç†è‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ³¨å†Œçš„ç”¨æˆ·é»˜è®¤æ˜¯ `role='user'`ï¼ˆæ™®é€šç”¨æˆ·ï¼‰
- âœ… åªèƒ½çœ‹åˆ°å’Œç®¡ç†è‡ªå·±åˆ›å»ºçš„äº¤æ˜“å‘˜
- âœ… éœ€è¦ OTP éªŒè¯ï¼ˆä¿æŒç°æœ‰è¡Œä¸ºï¼‰
- âœ… å¦‚æœéœ€è¦æˆä¸ºçœŸæ­£çš„ç®¡ç†å‘˜ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½® `role='admin'`

### 3.7 éšæœºç”Ÿæˆå·¥å…·å‡½æ•°

```go
// generateRandomEmail ç”Ÿæˆéšæœºé‚®ç®±
func generateRandomEmail() string {
    randomStr := uuid.New().String()[:8]
    return fmt.Sprintf("trader_%s@nofx.local", randomStr)
}

// generateRandomPassword ç”Ÿæˆéšæœºå¯†ç 
func generateRandomPassword(length int) string {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*"
    b := make([]byte, length)
    for i := range b {
        b[i] = charset[rand.Intn(len(charset))]
    }
    return string(b)
}
```

### 3.4 åˆ†ç±»ç®¡ç†æ¥å£ï¼ˆæ–°å¢ï¼‰

#### GET `/api/categories`
**æƒé™ï¼š** Admin, User

**åŠŸèƒ½ï¼š** è·å–åˆ†ç±»åˆ—è¡¨
- **Admin**: è¿”å›æ‰€æœ‰åˆ†ç±»ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- **User**: è¿”å›è‡ªå·±åˆ›å»ºçš„åˆ†ç±»

**å“åº”ï¼š**
```json
{
  "categories": [
    {
      "id": 1,
      "name": "Group A",
      "owner_user_id": "user123",
      "owner_email": "user@example.com",
      "trader_count": 5,
      "running_count": 3,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

#### POST `/api/categories`
**æƒé™ï¼š** Admin, User

**åŠŸèƒ½ï¼š** åˆ›å»ºåˆ†ç±»

**è¯·æ±‚ä½“ï¼š**
```json
{
  "name": "Group A",
  "description": "åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰"
}
```

**å“åº”ï¼š**
```json
{
  "id": 1,
  "name": "Group A",
  "owner_user_id": "user123",
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### PUT `/api/categories/:id`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥ä¿®æ”¹æ‰€æœ‰åˆ†ç±»ï¼ŒUseråªèƒ½ä¿®æ”¹è‡ªå·±çš„åˆ†ç±»ï¼‰

**åŠŸèƒ½ï¼š** æ›´æ–°åˆ†ç±»ä¿¡æ¯

**è¯·æ±‚ä½“ï¼š**
```json
{
  "name": "Group A Updated",
  "description": "æ›´æ–°åçš„åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰"
}
```

**å“åº”ï¼š**
```json
{
  "id": 1,
  "name": "Group A Updated",
  "owner_user_id": "user123",
  "description": "æ›´æ–°åçš„åˆ†ç±»æè¿°",
  "updated_at": "2024-01-02T00:00:00Z"
}
```

**å®ç°é€»è¾‘ï¼š**
```go
func (s *Server) handleUpdateCategory(c *gin.Context) {
    userID := c.GetString("user_id")
    categoryID := c.Param("id")
    
    // è·å–ç”¨æˆ·è§’è‰²
    user, _ := s.database.GetUserByID(userID)
    
    // è·å–åˆ†ç±»ä¿¡æ¯
    category, err := s.database.GetCategoryByID(categoryID)
    if err != nil || category == nil {
        c.JSON(http.StatusNotFound, gin.H{"error": "åˆ†ç±»ä¸å­˜åœ¨"})
        return
    }
    
    // æƒé™æ£€æŸ¥ï¼šå¦‚æœä¸æ˜¯adminï¼ŒéªŒè¯åˆ†ç±»æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    if user.Role != "admin" && category.OwnerUserID != userID {
        c.JSON(http.StatusForbidden, gin.H{"error": "åªèƒ½ä¿®æ”¹è‡ªå·±çš„åˆ†ç±»"})
        return
    }
    
    var req struct {
        Name        string `json:"name"`
        Description string `json:"description"`
    }
    
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    // å¦‚æœä¿®æ”¹äº†åç§°ï¼Œæ£€æŸ¥æ–°åç§°æ˜¯å¦å·²å­˜åœ¨ï¼ˆåŒä¸€ç”¨æˆ·ä¸‹ï¼‰
    if req.Name != "" && req.Name != category.Name {
        existing, _ := s.database.GetCategoryByNameAndOwner(req.Name, userID)
        if existing != nil && existing.ID != categoryID {
            c.JSON(http.StatusConflict, gin.H{"error": "åˆ†ç±»åç§°å·²å­˜åœ¨"})
            return
        }
    }
    
    // æ›´æ–°åˆ†ç±»
    err = s.database.UpdateCategory(categoryID, req.Name, req.Description)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "æ›´æ–°åˆ†ç±»å¤±è´¥"})
        return
    }
    
    // è¿”å›æ›´æ–°åçš„åˆ†ç±»ä¿¡æ¯
    updatedCategory, _ := s.database.GetCategoryByID(categoryID)
    c.JSON(http.StatusOK, updatedCategory)
}
```

#### DELETE `/api/categories/:id`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ é™¤æ‰€æœ‰åˆ†ç±»ï¼ŒUseråªèƒ½åˆ é™¤è‡ªå·±çš„åˆ†ç±»ï¼‰

**åŠŸèƒ½ï¼š** åˆ é™¤åˆ†ç±»

**çº§è”å¤„ç†ï¼š**
- **äº¤æ˜“å‘˜å’Œåˆ†ç±»ç‹¬ç«‹è®¾è®¡**ï¼šåˆ é™¤åˆ†ç±»æ—¶ï¼Œä¸ä¼šåˆ é™¤äº¤æ˜“å‘˜
- åˆ é™¤åˆ†ç±»æ—¶ï¼Œå°†è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜çš„ `category` å­—æ®µè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²
- äº¤æ˜“å‘˜ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯ä¸å†å±äºä»»ä½•åˆ†ç±»
- å°ç»„ç»„é•¿å¦‚æœè§‚æµ‹è¯¥åˆ†ç±»ï¼Œåˆ é™¤åˆ†ç±»åè¯¥å…³è”å…³ç³»ä¹Ÿä¼šè¢«åˆ é™¤ï¼ˆé€šè¿‡FOREIGN KEY CASCADEï¼‰

**å®ç°é€»è¾‘ï¼š**
```go
func (s *Server) handleDeleteCategory(c *gin.Context) {
    userID := c.GetString("user_id")
    categoryID := c.Param("id")
    
    // è·å–ç”¨æˆ·è§’è‰²
    user, _ := s.database.GetUserByID(userID)
    
    // è·å–åˆ†ç±»ä¿¡æ¯
    category, err := s.database.GetCategoryByID(categoryID)
    if err != nil || category == nil {
        c.JSON(http.StatusNotFound, gin.H{"error": "åˆ†ç±»ä¸å­˜åœ¨"})
        return
    }
    
    // æƒé™æ£€æŸ¥ï¼šå¦‚æœä¸æ˜¯adminï¼ŒéªŒè¯åˆ†ç±»æ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    if user.Role != "admin" && category.OwnerUserID != userID {
        c.JSON(http.StatusForbidden, gin.H{"error": "åªèƒ½åˆ é™¤è‡ªå·±çš„åˆ†ç±»"})
        return
    }
    
    categoryName := category.Name
    
    // 1. å°†è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜çš„categoryè®¾ä¸ºç©ºå­—ç¬¦ä¸²
    err = s.database.UpdateTradersCategoryToEmpty(categoryName)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "æ›´æ–°äº¤æ˜“å‘˜åˆ†ç±»å¤±è´¥"})
        return
    }
    
    // 2. åˆ é™¤åˆ†ç±»ï¼ˆä¼šè‡ªåŠ¨åˆ é™¤group_leader_categoriesä¸­çš„å…³è”ï¼Œé€šè¿‡FOREIGN KEY CASCADEï¼‰
    err = s.database.DeleteCategory(categoryID)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "åˆ é™¤åˆ†ç±»å¤±è´¥"})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "message": "åˆ†ç±»åˆ é™¤æˆåŠŸ",
        "category_name": categoryName,
    })
}
```

**æ³¨æ„ï¼š**
- âœ… äº¤æ˜“å‘˜å’Œåˆ†ç±»æ˜¯ç‹¬ç«‹çš„å…³ç³»ï¼Œåˆ é™¤åˆ†ç±»ä¸ä¼šåˆ é™¤äº¤æ˜“å‘˜
- âœ… åˆ é™¤åˆ†ç±»åï¼Œäº¤æ˜“å‘˜çš„ `category` å­—æ®µä¼šè¢«è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²
- âœ… å°ç»„ç»„é•¿å¦‚æœåªè§‚æµ‹è¯¥åˆ†ç±»ï¼Œåˆ é™¤åˆ†ç±»åè¯¥å…³è”å…³ç³»ä¼šè¢«åˆ é™¤
- âœ… å¦‚æœå°ç»„ç»„é•¿è¿˜è§‚æµ‹å…¶ä»–åˆ†ç±»ï¼Œå…¶ä»–å…³è”å…³ç³»ä¸å—å½±å“

#### POST `/api/traders/:id/category`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥è®¾ç½®æ‰€æœ‰äº¤æ˜“å‘˜çš„åˆ†ç±»ï¼ŒUseråªèƒ½è®¾ç½®è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼‰

**åŠŸèƒ½ï¼š** è®¾ç½®äº¤æ˜“å‘˜åˆ†ç±»

**è¯·æ±‚ä½“ï¼š**
```json
{
  "category": "Group A"  // åˆ†ç±»åç§°
}
```

**æ³¨æ„ï¼š**
- Adminå¯ä»¥è®¾ç½®æ‰€æœ‰äº¤æ˜“å‘˜çš„åˆ†ç±»ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- æ™®é€šç”¨æˆ·åªèƒ½å°†äº¤æ˜“å‘˜è®¾ç½®åˆ°è‡ªå·±åˆ›å»ºçš„åˆ†ç±»
- éœ€è¦éªŒè¯åˆ†ç±»çš„owner_user_idä¸å½“å‰ç”¨æˆ·IDåŒ¹é…ï¼ˆAdminè·³è¿‡æ­¤æ£€æŸ¥ï¼‰

### 3.5 æ–°å¢ï¼šäº¤æ˜“å‘˜è´¦å·ç®¡ç†æ¥å£

#### POST `/api/traders/:id/create-account`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ›å»ºæ‰€æœ‰äº¤æ˜“å‘˜çš„è´¦å·ï¼ŒUseråªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼‰

**åŠŸèƒ½ï¼š** ä¸ºäº¤æ˜“å‘˜åˆ›å»ºè´¦å·

**è¯·æ±‚ä½“ï¼š**
```json
{
  "generate_random_email": true,    // true=è´¦å·éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥è´¦å·
  "generate_random_password": true, // true=å¯†ç éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥å¯†ç 
  "email": "trader1@example.com",   // å¦‚æœgenerate_random_email=falseï¼Œå¿…å¡«
  "password": "password123"         // å¦‚æœgenerate_random_password=falseï¼Œå¿…å¡«
}
```

**å››ç§ç»„åˆæ¨¡å¼ï¼š**
1. **è´¦å·éšæœºï¼Œå¯†ç è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=true, generate_random_password=false, passwordå¿…å¡«`
2. **å¯†ç éšæœºï¼Œè´¦å·è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=true, emailå¿…å¡«`
3. **å…¨éšæœº**ï¼š`generate_random_email=true, generate_random_password=true`
4. **å…¨è‡ªå·±è¾“å…¥**ï¼š`generate_random_email=false, generate_random_password=false, emailå’Œpasswordå¿…å¡«`

**å“åº”ï¼š**
```json
{
  "user_id": "trader_account_123",
  "email": "trader1@example.com",  // æœ€ç»ˆä½¿ç”¨çš„è´¦å·ï¼ˆéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥ï¼‰
  "password": "generated_password",  // æœ€ç»ˆä½¿ç”¨çš„å¯†ç ï¼ˆéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥ï¼Œä»…æ­¤ä¸€æ¬¡è¿”å›ï¼‰
  "trader_id": "trader123"
}
```

#### DELETE `/api/traders/:id/account`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ é™¤æ‰€æœ‰äº¤æ˜“å‘˜çš„è´¦å·ï¼ŒUseråªèƒ½åˆ é™¤è‡ªå·±äº¤æ˜“å‘˜çš„è´¦å·ï¼‰

**åŠŸèƒ½ï¼š** åˆ é™¤äº¤æ˜“å‘˜çš„è´¦å·

#### GET `/api/traders/:id/account`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“å‘˜çš„è´¦å·ä¿¡æ¯ï¼ŒUseråªèƒ½æŸ¥çœ‹è‡ªå·±äº¤æ˜“å‘˜çš„è´¦å·ä¿¡æ¯ï¼‰

**åŠŸèƒ½ï¼š** è·å–äº¤æ˜“å‘˜çš„è´¦å·ä¿¡æ¯

**å“åº”ï¼š**
```json
{
  "account": {
    "user_id": "trader_account_123",
    "email": "trader1@example.com",
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

### 3.6 æ–°å¢ï¼šå°ç»„ç»„é•¿ç®¡ç†æ¥å£

#### POST `/api/group-leaders/create`
**æƒé™ï¼š** Userï¼ˆåªèƒ½ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼‰

**åŠŸèƒ½ï¼š** åˆ›å»ºå°ç»„ç»„é•¿è´¦å·

**è¯·æ±‚ä½“ï¼š**
```json
{
  "generate_random": true,   // true=éšæœºç”Ÿæˆï¼Œfalse=æ‰‹åŠ¨è¾“å…¥
  "email": "leader1@example.com",  // å¦‚æœgenerate_random=falseï¼Œå¿…å¡«
  "password": "password123",        // å¦‚æœgenerate_random=falseï¼Œå¿…å¡«
  "categories": ["Group A", "Group B"]  // å¿…å¡«ï¼šå¯ä»¥è§‚æµ‹çš„åˆ†ç±»åˆ—è¡¨ï¼ˆå¿…é¡»æ˜¯è‡ªå·±çš„åˆ†ç±»ï¼‰
}
```

**å“åº”ï¼š**
```json
{
  "user_id": "group_leader_123",
  "email": "leader1@example.com",
  "password": "generated_password",  // å¦‚æœè‡ªåŠ¨ç”Ÿæˆ
  "categories": ["Group A", "Group B"]
}
```

#### GET `/api/group-leaders`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å°ç»„ç»„é•¿åˆ—è¡¨ï¼ŒUseråªèƒ½æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„å°ç»„ç»„é•¿åˆ—è¡¨ï¼‰

**åŠŸèƒ½ï¼š** è·å–å°ç»„ç»„é•¿åˆ—è¡¨

**å“åº”ï¼š**
```json
{
  "leaders": [
    {
      "user_id": "group_leader_123",
      "email": "leader1@example.com",
      "categories": ["Group A", "Group B"],
      "trader_count": 8,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

#### PUT `/api/group-leaders/:id/categories`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥æ›´æ–°æ‰€æœ‰å°ç»„ç»„é•¿çš„åˆ†ç±»ï¼ŒUseråªèƒ½æ›´æ–°è‡ªå·±åˆ›å»ºçš„å°ç»„ç»„é•¿çš„åˆ†ç±»ï¼‰

**åŠŸèƒ½ï¼š** æ›´æ–°å°ç»„ç»„é•¿çš„åˆ†ç±»

**è¯·æ±‚ä½“ï¼š**
```json
{
  "categories": ["Group A", "Group C"]  // Adminå¯ä»¥æ˜¯æ‰€æœ‰åˆ†ç±»ï¼ŒUserå¿…é¡»æ˜¯è‡ªå·±çš„åˆ†ç±»
}
```

#### DELETE `/api/group-leaders/:id`
**æƒé™ï¼š** Admin, Userï¼ˆAdminå¯ä»¥åˆ é™¤æ‰€æœ‰å°ç»„ç»„é•¿è´¦å·ï¼ŒUseråªèƒ½åˆ é™¤è‡ªå·±åˆ›å»ºçš„å°ç»„ç»„é•¿è´¦å·ï¼‰

**åŠŸèƒ½ï¼š** åˆ é™¤å°ç»„ç»„é•¿è´¦å·

---

## ğŸ¨ å‰ç«¯ç•Œé¢è®¾è®¡ï¼ˆæœ€å°åŒ–ä¿®æ”¹ï¼‰

### 4.1 æ ¸å¿ƒä¿®æ”¹ç‚¹

#### 4.1.1 äº¤æ˜“å‘˜åˆ—è¡¨é¡µé¢ (AITradersPage.tsx)

**ä¿®æ”¹ä½ç½®ï¼š** `web/src/components/AITradersPage.tsx`

**ä¿®æ”¹æ–¹å¼ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²éšè—/æ˜¾ç¤ºæ“ä½œæŒ‰é’®**

```typescript
// 1. ä»ç”¨æˆ·ä¿¡æ¯è·å–è§’è‰²
const { user } = useAuth()
const userRole = user?.role || 'user' // é»˜è®¤userï¼ˆå‘åå…¼å®¹ï¼‰

// 2. åˆ¤æ–­æ˜¯å¦å¯ä»¥ç¼–è¾‘
const canEdit = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥ç¼–è¾‘è‡ªå·±çš„äº¤æ˜“å‘˜
const canCreate = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºäº¤æ˜“å‘˜
const canDelete = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ é™¤è‡ªå·±çš„äº¤æ˜“å‘˜
const canManageCategories = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥ç®¡ç†åˆ†ç±»
const canCreateAccount = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºè´¦å·
const canCreateGroupLeader = userRole === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºå°ç»„ç»„é•¿

// 3. åœ¨JSXä¸­æ¡ä»¶æ¸²æŸ“
{canCreate && (
  <button onClick={() => setShowCreateModal(true)}>
    åˆ›å»ºäº¤æ˜“å‘˜
  </button>
)}

{traders.map(trader => (
  <div key={trader.trader_id}>
    {/* äº¤æ˜“å‘˜ä¿¡æ¯ */}
    <div>{trader.trader_name}</div>
    
    {/* æ“ä½œæŒ‰é’® - æ ¹æ®æƒé™æ˜¾ç¤º/éšè— */}
    {canEdit && (
      <button onClick={() => handleEditTrader(trader.trader_id)}>
        ç¼–è¾‘
      </button>
    )}
    {canDelete && (
      <button onClick={() => handleDeleteTrader(trader.trader_id)}>
        åˆ é™¤
      </button>
    )}
    {canManageCategories && (
      <button onClick={() => handleSetCategory(trader.trader_id)}>
        è®¾ç½®åˆ†ç±»
      </button>
    )}
    {canManageAccounts && (
      <button onClick={() => handleCreateAccount(trader.trader_id)}>
        åˆ›å»ºè´¦å·
      </button>
    )}
  </div>
))}
```

**å…³é”®ç‚¹ï¼š**
- âœ… **äº¤æ˜“å‘˜åˆ—è¡¨è‡ªåŠ¨è¿‡æ»¤**ï¼šAPIè¿”å›çš„æ•°æ®å·²ç»æ ¹æ®è§’è‰²è¿‡æ»¤ï¼Œå‰ç«¯æ— éœ€ä¿®æ”¹
- âœ… **åªä¿®æ”¹æ˜¾ç¤ºé€»è¾‘**ï¼šé€šè¿‡æ¡ä»¶æ¸²æŸ“éšè—/æ˜¾ç¤ºæŒ‰é’®
- âœ… **å¤ç”¨ç°æœ‰ç»„ä»¶**ï¼šä¸éœ€è¦åˆ›å»ºæ–°ç»„ä»¶

#### 4.1.2 äº¤æ˜“å‘˜è¯¦æƒ…é¡µé¢ (TraderDetailsPage in App.tsx)

**ä¿®æ”¹ä½ç½®ï¼š** `web/src/App.tsx` - `TraderDetailsPage` ç»„ä»¶

**äº¤æ˜“å‘˜ä¸‹æ‹‰åˆ—è¡¨ï¼š**
```typescript
// ç°æœ‰ä»£ç ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
<select
  value={selectedTraderId}
  onChange={(e) => onTraderSelect(e.target.value)}
>
  {traders.map((trader) => (
    <option key={trader.trader_id} value={trader.trader_id}>
      {trader.trader_name}
    </option>
  ))}
</select>
```

**è¯´æ˜ï¼š**
- âœ… **ä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨é€‚é…**ï¼š`traders` æ•°ç»„å·²ç»ç”±APIæ ¹æ®è§’è‰²è¿‡æ»¤ï¼Œä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨åªæ˜¾ç¤ºæœ‰æƒé™çš„äº¤æ˜“å‘˜
- âœ… **æ— éœ€ä¿®æ”¹**ï¼šç°æœ‰ä»£ç å·²ç»æ»¡è¶³éœ€æ±‚

**æ“ä½œæŒ‰é’®éšè—ï¼š**
```typescript
// åœ¨äº¤æ˜“å‘˜è¯¦æƒ…é¡µä¸­ï¼Œæ ¹æ®è§’è‰²éšè—ç¼–è¾‘åŠŸèƒ½
const canEdit = user?.role === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥ç¼–è¾‘è‡ªå·±çš„äº¤æ˜“å‘˜

{canEdit && (
  <button onClick={handleEdit}>ç¼–è¾‘é…ç½®</button>
)}
```

#### 4.1.3 é…ç½®ç®¡ç†é¡µé¢

**ä¿®æ”¹ä½ç½®ï¼š** `web/src/components/AITradersPage.tsx`

**AIæ¨¡å‹é…ç½®ã€äº¤æ˜“æ‰€é…ç½®ã€ä¿¡å·æºé…ç½®ï¼š**
```typescript
const canManageConfig = user?.role === 'user'  // æ™®é€šç”¨æˆ·å¯ä»¥é…ç½®è‡ªå·±çš„äº¤æ˜“å‘˜

{canManageConfig && (
  <>
    <button onClick={() => setShowModelModal(true)}>
      AIæ¨¡å‹é…ç½®
    </button>
    <button onClick={() => setShowExchangeModal(true)}>
      äº¤æ˜“æ‰€é…ç½®
    </button>
    <button onClick={() => setShowSignalSourceModal(true)}>
      ä¿¡å·æºé…ç½®
    </button>
  </>
)}
```

**å…³é”®ç‚¹ï¼š**
- âœ… **å®Œå…¨éšè—é…ç½®å…¥å£**ï¼šéæ™®é€šç”¨æˆ·ï¼ˆgroup_leaderå’Œtrader_accountï¼‰çœ‹ä¸åˆ°é…ç½®æŒ‰é’®
- âœ… **æœ€å°åŒ–ä¿®æ”¹**ï¼šåªéœ€è¦æ·»åŠ æ¡ä»¶åˆ¤æ–­

#### 4.1.2 åˆ†ç±»ç®¡ç†é¡µé¢ `/admin/categories` (æ–°å¢)

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»åˆ—è¡¨
- åˆ›å»º/åˆ é™¤åˆ†ç±»
- æŸ¥çœ‹æ¯ä¸ªåˆ†ç±»çš„äº¤æ˜“å‘˜æ•°é‡
- æ‰¹é‡è®¾ç½®äº¤æ˜“å‘˜åˆ†ç±»

**å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ†ç±»ç®¡ç†                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åˆ›å»ºåˆ†ç±»]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Group A                            â”‚ â”‚
â”‚  â”‚ äº¤æ˜“å‘˜: 5 | è¿è¡Œä¸­: 3              â”‚ â”‚
â”‚  â”‚ [æŸ¥çœ‹äº¤æ˜“å‘˜] [ç¼–è¾‘] [åˆ é™¤]          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.3 è´¦å·ç®¡ç†é¡µé¢ `/admin/accounts` (æ–°å¢)

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºæ‰€æœ‰äº¤æ˜“å‘˜è´¦å·åˆ—è¡¨
- æ˜¾ç¤ºæ‰€æœ‰å°ç»„ç»„é•¿è´¦å·åˆ—è¡¨
- åˆ›å»º/åˆ é™¤è´¦å·
- é‡ç½®å¯†ç 

**å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è´¦å·ç®¡ç†                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åˆ›å»ºäº¤æ˜“å‘˜è´¦å·] [åˆ›å»ºå°ç»„ç»„é•¿è´¦å·]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº¤æ˜“å‘˜è´¦å·:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ trader1@example.com                â”‚ â”‚
â”‚  â”‚ å…³è”äº¤æ˜“å‘˜: Trader 1               â”‚ â”‚
â”‚  â”‚ [é‡ç½®å¯†ç ] [åˆ é™¤]                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  å°ç»„ç»„é•¿è´¦å·:                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ leader1@example.com                â”‚ â”‚
â”‚  â”‚ ç®¡ç†åˆ†ç±»: Group A, Group B         â”‚ â”‚
â”‚  â”‚ [ç¼–è¾‘åˆ†ç±»] [é‡ç½®å¯†ç ] [åˆ é™¤]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å°ç»„ç»„é•¿ç•Œé¢ï¼ˆåªè¯»ï¼‰

#### 4.2.1 äº¤æ˜“å‘˜åˆ—è¡¨é¡µé¢ `/traders` (AITradersPage - åªè¯»æ¨¡å¼)

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºç®¡ç†çš„åˆ†ç±»å†…çš„æ‰€æœ‰äº¤æ˜“å‘˜
- æŒ‰åˆ†ç±»åˆ†ç»„æ˜¾ç¤º
- æŸ¥çœ‹äº¤æ˜“å‘˜è¯¦æƒ…ï¼ˆåªè¯»ï¼‰
- **éšè—æ‰€æœ‰ç¼–è¾‘/åˆ é™¤/åˆ›å»ºæŒ‰é’®**

**å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘çš„äº¤æ˜“å‘˜ï¼ˆåªè¯»ï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç­›é€‰åˆ†ç±»: Group A â–¼] [æœç´¢]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¼ Group A (5ä¸ªäº¤æ˜“å‘˜)                   â”‚
â”‚    â”œâ”€ Trader 1 [è¿è¡Œä¸­] [+12.34%]       â”‚
â”‚    â”‚  [æŸ¥çœ‹è¯¦æƒ…]                        â”‚
â”‚    â”œâ”€ Trader 2 [å·²åœæ­¢] [-5.67%]       â”‚
â”‚    â”‚  [æŸ¥çœ‹è¯¦æƒ…]                        â”‚
â”‚    â””â”€ ...                                â”‚
â”‚  â–¼ Group B (3ä¸ªäº¤æ˜“å‘˜)                   â”‚
â”‚    â””â”€ ...                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 äº¤æ˜“å‘˜è¯¦æƒ…é¡µé¢ `/traders/:id` (TraderDetailsPage - åªè¯»æ¨¡å¼)

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºäº¤æ˜“å‘˜è¯¦ç»†ä¿¡æ¯ï¼ˆåªè¯»ï¼‰
- è´¦æˆ·ä½™é¢ã€æŒä»“ã€å†³ç­–è®°å½•ç­‰
- **éšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®å’Œé…ç½®é€‰é¡¹**

**å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº¤æ˜“å‘˜è¯¦æƒ… (åªè¯»)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº¤æ˜“å‘˜åç§°: Trader 1                    â”‚
â”‚  åˆ†ç±»: Group A                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è´¦æˆ·æ¦‚è§ˆå¡ç‰‡]                           â”‚
â”‚  [æŒä»“åˆ—è¡¨]                              â”‚
â”‚  [å†³ç­–è®°å½•]                              â”‚
â”‚  [ç»Ÿè®¡æ•°æ®]                              â”‚
â”‚  ï¼ˆæ‰€æœ‰ç¼–è¾‘åŠŸèƒ½å·²éšè—ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 äº¤æ˜“å‘˜è´¦å·ç•Œé¢ï¼ˆåªè¯»ï¼‰

#### 4.3.1 äº¤æ˜“å‘˜è¯¦æƒ…é¡µé¢ `/traders/:id` (TraderDetailsPage - åªè¯»æ¨¡å¼)

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºè‡ªå·±çš„äº¤æ˜“å‘˜è¯¦ç»†ä¿¡æ¯ï¼ˆåªè¯»ï¼‰
- è´¦æˆ·ä½™é¢ã€æŒä»“ã€å†³ç­–è®°å½•ç­‰
- **éšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®å’Œé…ç½®é€‰é¡¹**

**å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘çš„äº¤æ˜“å‘˜ (åªè¯»)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº¤æ˜“å‘˜åç§°: Trader 1                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è´¦æˆ·æ¦‚è§ˆå¡ç‰‡]                           â”‚
â”‚  [æŒä»“åˆ—è¡¨]                              â”‚
â”‚  [å†³ç­–è®°å½•]                              â”‚
â”‚  [ç»Ÿè®¡æ•°æ®]                              â”‚
â”‚  ï¼ˆæ‰€æœ‰ç¼–è¾‘åŠŸèƒ½å·²éšè—ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ å®ç°æ­¥éª¤ï¼ˆæœ€å°åŒ–ä¿®æ”¹ç‰ˆï¼‰

### Phase 1: æ•°æ®åº“æ‰©å±•ï¼ˆ1å¤©ï¼‰

1. **ç”¨æˆ·è¡¨æ‰©å±•ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰**
   ```sql
   -- æ·»åŠ è§’è‰²å­—æ®µï¼Œé»˜è®¤å€¼ä¸º'user'ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
   ALTER TABLE users ADD COLUMN role TEXT DEFAULT 'user';
   -- æ³¨æ„ï¼šç°æœ‰ç”¨æˆ·çš„roleä¼šè‡ªåŠ¨è®¾ç½®ä¸º'user'ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
   
   -- æ·»åŠ å…³è”å­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
   ALTER TABLE users ADD COLUMN trader_id TEXT DEFAULT NULL;
   ALTER TABLE users ADD COLUMN category TEXT DEFAULT NULL;
   -- æ³¨æ„ï¼šç°æœ‰ç”¨æˆ·çš„è¿™äº›å­—æ®µé»˜è®¤ä¸ºNULLï¼Œä¸å½±å“ç°æœ‰æ•°æ®
   ```

2. **äº¤æ˜“å‘˜è¡¨æ‰©å±•ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰**
   ```sql
   -- æ·»åŠ åˆ†ç±»å­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
   ALTER TABLE traders ADD COLUMN category TEXT DEFAULT '';
   -- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„categoryé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
   
   -- æ·»åŠ äº¤æ˜“å‘˜è´¦å·å…³è”å­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
   ALTER TABLE traders ADD COLUMN trader_account_id TEXT DEFAULT NULL;
   -- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„trader_account_idé»˜è®¤ä¸ºNULLï¼Œä¸å½±å“ç°æœ‰æ•°æ®
   
   -- æ·»åŠ æ‰€æœ‰è€…ç”¨æˆ·IDå­—æ®µï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼Œéœ€è¦æ•°æ®è¿ç§»ï¼‰
   ALTER TABLE traders ADD COLUMN owner_user_id TEXT DEFAULT NULL;
   -- æ³¨æ„ï¼šç°æœ‰äº¤æ˜“å‘˜çš„owner_user_idé»˜è®¤ä¸ºNULL
   -- éœ€è¦æ ¹æ®ç°æœ‰æ•°æ®å…³è”è®¾ç½®ï¼šUPDATE traders SET owner_user_id = (å…³è”çš„user_id)
   ```

3. **åˆ›å»ºåˆ†ç±»è¡¨ï¼ˆæ–°è¡¨ï¼Œä¸å½±å“ç°æœ‰æ•°æ®ï¼‰**
   ```sql
   CREATE TABLE IF NOT EXISTS categories (
       id INTEGER PRIMARY KEY AUTOINCREMENT,
       name TEXT NOT NULL,
       owner_user_id TEXT NOT NULL,
       description TEXT DEFAULT '',
       created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
       updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
       UNIQUE(owner_user_id, name)  -- åŒä¸€ç”¨æˆ·ä¸èƒ½åˆ›å»ºåŒååˆ†ç±»
   );
   CREATE INDEX idx_owner_user ON categories(owner_user_id);
   ```

4. **åˆ›å»ºå°ç»„ç»„é•¿åˆ†ç±»å…³è”è¡¨ï¼ˆæ–°è¡¨ï¼Œä¸å½±å“ç°æœ‰æ•°æ®ï¼‰**
   ```sql
   CREATE TABLE IF NOT EXISTS group_leader_categories (
       id INTEGER PRIMARY KEY AUTOINCREMENT,
       group_leader_id TEXT NOT NULL,
       category TEXT NOT NULL,
       owner_user_id TEXT NOT NULL,  -- åˆ†ç±»æ‰€æœ‰è€…ç”¨æˆ·ID
       created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
       updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
       FOREIGN KEY (group_leader_id) REFERENCES users(id) ON DELETE CASCADE,
       UNIQUE(group_leader_id, category)
   );
   CREATE INDEX idx_group_leader ON group_leader_categories(group_leader_id);
   CREATE INDEX idx_category ON group_leader_categories(category);
   CREATE INDEX idx_owner_user ON group_leader_categories(owner_user_id);
   ```

5. **æ•°æ®è¿ç§»ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰**
   - **ç”¨æˆ·è¡¨è¿ç§»**ï¼š
     ```sql
     -- å°†ç°æœ‰ç”¨æˆ·çš„roleè®¾ç½®ä¸º'user'ï¼ˆå¦‚æœä¸ºNULLï¼‰
     UPDATE users SET role = 'user' WHERE role IS NULL OR role = '';
     ```
   - **äº¤æ˜“å‘˜è¡¨è¿ç§»**ï¼š
     ```sql
     -- æ ¹æ®ç°æœ‰æ•°æ®å…³è”è®¾ç½®owner_user_id
     -- å¦‚æœç°æœ‰tradersè¡¨æœ‰user_idå­—æ®µï¼Œç›´æ¥ä½¿ç”¨å®ƒè®¾ç½®owner_user_id
     UPDATE traders SET owner_user_id = user_id WHERE owner_user_id IS NULL AND user_id IS NOT NULL;
     -- æ³¨æ„ï¼šå¦‚æœtradersè¡¨æ²¡æœ‰user_idå­—æ®µï¼Œéœ€è¦é€šè¿‡ä»£ç é€»è¾‘å¤„ç†
     ```
   - **ä»£ç è¿ç§»é€»è¾‘**ï¼ˆSQLiteä¸æ”¯æŒå¤æ‚SQLï¼Œéœ€è¦åœ¨ä»£ç ä¸­å¤„ç†ï¼‰ï¼š
     ```go
     // åœ¨æ•°æ®åº“åˆå§‹åŒ–æˆ–å‡çº§æ—¶æ‰§è¡Œ
     func (d *Database) MigrateTradersOwnerUserID() error {
         // è·å–æ‰€æœ‰owner_user_idä¸ºNULLçš„äº¤æ˜“å‘˜
         rows, err := d.db.Query("SELECT id, user_id FROM traders WHERE owner_user_id IS NULL")
         if err != nil {
             return err
         }
         defer rows.Close()
         
         for rows.Next() {
             var traderID, userID string
             if err := rows.Scan(&traderID, &userID); err != nil {
                 continue
             }
             
             // å¦‚æœuser_idå­˜åœ¨ï¼Œè®¾ç½®ä¸ºowner_user_id
             if userID != "" {
                 _, err := d.db.Exec("UPDATE traders SET owner_user_id = ? WHERE id = ?", userID, traderID)
                 if err != nil {
                     log.Printf("æ›´æ–°äº¤æ˜“å‘˜ %s çš„owner_user_idå¤±è´¥: %v", traderID, err)
                 }
             }
         }
         return nil
     }
     ```
   - **å‘åå…¼å®¹**ï¼š
     - ç°æœ‰ç”¨æˆ·é»˜è®¤æ˜¯ `role='user'`ï¼Œå¯ä»¥åˆ›å»ºåˆ†ç±»å’Œè´¦å·
     - ç°æœ‰äº¤æ˜“å‘˜æ•°æ®å®Œå…¨ä¿ç•™ï¼Œcategoryå’Œtrader_account_idé»˜è®¤ä¸ºç©º/NULL
     - owner_user_idå¦‚æœæ— æ³•ç¡®å®šï¼Œä¿æŒä¸ºNULLï¼Œä½†æ–°åˆ›å»ºçš„äº¤æ˜“å‘˜ä¼šè‡ªåŠ¨è®¾ç½®
     - ä¸å½±å“Admin ModeåŠŸèƒ½ï¼Œä¸¤è€…ç‹¬ç«‹å·¥ä½œ
     - æ–°åˆ›å»ºçš„äº¤æ˜“å‘˜ä¼šè‡ªåŠ¨è®¾ç½®owner_user_idå’Œcategoryï¼ˆå¦‚æœæä¾›ï¼‰

### Phase 2: åç«¯APIä¿®æ”¹ï¼ˆ1-2å¤©ï¼‰

#### 2.1 ä¿®æ”¹ `handleRegister` (è®¾ç½®è§’è‰²)
**æ–‡ä»¶ï¼š** `api/server.go:1572`

**ä¿®æ”¹å†…å®¹ï¼š**
- æ³¨å†Œæ—¶è®¾ç½® `role='user'`ï¼ˆæ™®é€šç”¨æˆ·ï¼‰
- ä¿æŒå…¶ä»–é€»è¾‘ä¸å˜

#### 2.2 ä¿®æ”¹ `handleTraderList` (æ ¸å¿ƒä¿®æ”¹)
**æ–‡ä»¶ï¼š** `api/server.go:1096`

**ä¿®æ”¹å†…å®¹ï¼š**
- è·å–ç”¨æˆ·è§’è‰²
- æ ¹æ®è§’è‰²æŸ¥è¯¢ä¸åŒçš„äº¤æ˜“å‘˜åˆ—è¡¨
- `admin` â†’ æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- `user` â†’ è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼ˆé€šè¿‡åˆ†ç±»è¡¨å…³è”ï¼‰
- `group_leader` â†’ è§‚æµ‹çš„åˆ†ç±»å†…çš„äº¤æ˜“å‘˜ï¼ˆåˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼‰
- `trader_account` â†’ è‡ªå·±çš„äº¤æ˜“å‘˜ï¼ˆé€šè¿‡trader_idå…³è”ï¼‰
- ä¿æŒå“åº”æ ¼å¼ä¸å˜

**ä»£ç ç¤ºä¾‹ï¼š**
```go
func (s *Server) handleTraderList(c *gin.Context) {
    userID := c.GetString("user_id")
    
    // è·å–ç”¨æˆ·è§’è‰²
    user, err := s.database.GetUserByID(userID)
    if err != nil {
        // å‘åå…¼å®¹ï¼šå¦‚æœè·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è¡Œä¸º
        traders, _ := s.database.GetTraders(userID)
        // ... è¿”å›ç»“æœ
        return
    }
    
    role := user.Role
    if role == "" {
        role = "user" // é»˜è®¤æ˜¯æ™®é€šç”¨æˆ·
    }
    
    var traders []*TraderRecord
    switch role {
    case "admin":
        // çœŸæ­£çš„ç®¡ç†å‘˜ï¼šè¿”å›æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
        traders, _ = s.database.GetAllTraders()
    case "user":
        // æ™®é€šç”¨æˆ·ï¼šè¿”å›è‡ªå·±åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜ï¼Œæˆ–owner_user_idä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜
        userCategories := s.database.GetUserCategories(userID)
        if len(userCategories) == 0 {
            // å‘åå…¼å®¹ï¼šå¦‚æœæ²¡æœ‰åˆ†ç±»ï¼Œè¿”å›owner_user_idä¸ºè¯¥ç”¨æˆ·çš„äº¤æ˜“å‘˜
            traders, _ = s.database.GetTradersByOwnerUserID(userID)
        } else {
            // è¿”å›åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼Œä»¥åŠowner_user_idä¸ºè¯¥ç”¨æˆ·ä½†categoryä¸ºç©ºçš„äº¤æ˜“å‘˜
            categoryTraders, _ := s.database.GetTradersByCategories(userCategories)
            ownerTraders, _ := s.database.GetTradersByOwnerUserID(userID)
            // åˆå¹¶å¹¶å»é‡
            traderMap := make(map[string]*TraderRecord)
            for _, t := range categoryTraders {
                traderMap[t.ID] = t
            }
            for _, t := range ownerTraders {
                // åªæ·»åŠ categoryä¸ºç©ºæˆ–å±äºç”¨æˆ·åˆ†ç±»çš„äº¤æ˜“å‘˜
                if t.Category == "" || contains(userCategories, t.Category) {
                    traderMap[t.ID] = t
                }
            }
            traders = make([]*TraderRecord, 0, len(traderMap))
            for _, t := range traderMap {
                traders = append(traders, t)
            }
        }
    case "group_leader":
        // å°ç»„ç»„é•¿ï¼šè¿”å›è§‚æµ‹çš„åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜
        categories := s.database.GetGroupLeaderCategories(userID)
        traders, _ = s.database.GetTradersByCategories(categories)
    case "trader_account":
        // äº¤æ˜“å‘˜è´¦å·ï¼šè¿”å›è‡ªå·±çš„äº¤æ˜“å‘˜
        // æ³¨æ„ï¼šGetTradersByIDè¿”å›æ•°ç»„ï¼Œä½†trader_accountåº”è¯¥åªæœ‰ä¸€ä¸ªäº¤æ˜“å‘˜
        traderList, _ := s.database.GetTradersByID(user.TraderID)
        if len(traderList) > 0 {
            traders = traderList  // è¿”å›æ•°ç»„ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå…ƒç´ 
        } else {
            traders = []*TraderRecord{}  // è¿”å›ç©ºæ•°ç»„
        }
    default:
        // å‘åå…¼å®¹ï¼šé»˜è®¤åªè¿”å›è‡ªå·±çš„äº¤æ˜“å‘˜ï¼ˆé€šè¿‡owner_user_idæˆ–åˆ†ç±»ï¼‰
        // å¦‚æœæ²¡æœ‰roleå­—æ®µï¼Œé»˜è®¤è¡Œä¸ºæ˜¯user
        userCategories := s.database.GetUserCategories(userID)
        if len(userCategories) == 0 {
            // å¦‚æœæ²¡æœ‰åˆ†ç±»ï¼Œè¿”å›owner_user_idä¸ºè¯¥ç”¨æˆ·çš„äº¤æ˜“å‘˜
            traders, _ = s.database.GetTradersByOwnerUserID(userID)
        } else {
            // è¿”å›åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼Œä»¥åŠowner_user_idä¸ºè¯¥ç”¨æˆ·ä½†categoryä¸ºç©ºçš„äº¤æ˜“å‘˜
            categoryTraders, _ := s.database.GetTradersByCategories(userCategories)
            ownerTraders, _ := s.database.GetTradersByOwnerUserID(userID)
            traderMap := make(map[string]*TraderRecord)
            for _, t := range categoryTraders {
                traderMap[t.ID] = t
            }
            for _, t := range ownerTraders {
                if t.Category == "" || contains(userCategories, t.Category) {
                    traderMap[t.ID] = t
                }
            }
            traders = make([]*TraderRecord, 0, len(traderMap))
            for _, t := range traderMap {
                traders = append(traders, t)
            }
        }
    }
    
    // åç»­ä»£ç ä¿æŒä¸å˜
    // ...
}
```

#### 2.3 ä¿®æ”¹ `handleAccount` (æ·»åŠ è§’è‰²ä¿¡æ¯)
**æ–‡ä»¶ï¼š** `api/server.go` - `handleAccount` å‡½æ•°

**ä¿®æ”¹å†…å®¹ï¼š**
- åœ¨å“åº”ä¸­æ·»åŠ  `role`ã€`trader_id`ã€`categories` å­—æ®µ

#### 2.4 æ·»åŠ æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•
**æ–‡ä»¶ï¼š** `config/database.go`

**æ–°å¢æ–¹æ³•ï¼š**
- `GetUserByID(userID string) (*User, error)` - è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å«è§’è‰²ï¼‰
- `GetAllTraders() ([]*TraderRecord, error)` - è·å–æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆAdminç”¨ï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
- `GetUserCategories(userID string) ([]string, error)` - è·å–ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰åˆ†ç±»åç§°
- `GetGroupLeaderCategories(userID string) ([]string, error)` - è·å–å°ç»„ç»„é•¿å¯ä»¥è§‚æµ‹çš„åˆ†ç±»
- `GetTradersByCategories(categories []string) ([]*TraderRecord, error)` - æ ¹æ®åˆ†ç±»è·å–äº¤æ˜“å‘˜
- `GetTradersByID(traderID string) ([]*TraderRecord, error)` - æ ¹æ®IDè·å–äº¤æ˜“å‘˜ï¼ˆè¿”å›æ•°ç»„ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªï¼‰
- `GetTraderByID(traderID string) (*TraderRecord, error)` - æ ¹æ®IDè·å–å•ä¸ªäº¤æ˜“å‘˜ï¼ˆåŒ…å«owner_user_idå’Œcategoryï¼‰
- `GetTradersByOwnerUserID(userID string) ([]*TraderRecord, error)` - æ ¹æ®owner_user_idè·å–äº¤æ˜“å‘˜åˆ—è¡¨
- `CreateCategory(userID, name, description string) (*Category, error)` - åˆ›å»ºåˆ†ç±»
- `GetCategoryByID(categoryID int) (*Category, error)` - æ ¹æ®IDè·å–åˆ†ç±»
- `GetCategoryByName(categoryName string) (*Category, error)` - æ ¹æ®åç§°è·å–åˆ†ç±»
- `GetCategoryByNameAndOwner(categoryName, ownerUserID string) (*Category, error)` - æ ¹æ®åç§°å’Œæ‰€æœ‰è€…è·å–åˆ†ç±»
- `GetCategoriesByOwner(userID string) ([]*Category, error)` - è·å–ç”¨æˆ·åˆ›å»ºçš„åˆ†ç±»åˆ—è¡¨
- `UpdateCategory(categoryID int, name, description string) error` - æ›´æ–°åˆ†ç±»ä¿¡æ¯
- `DeleteCategory(categoryID int) error` - åˆ é™¤åˆ†ç±»
- `UpdateTraderCategory(traderID, category string) error` - æ›´æ–°äº¤æ˜“å‘˜åˆ†ç±»
- `UpdateTradersCategoryToEmpty(categoryName string) error` - å°†æŒ‡å®šåˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜çš„categoryè®¾ä¸ºç©ºå­—ç¬¦ä¸²
- `InsertGroupLeaderCategory(groupLeaderID, category, ownerUserID string) error` - æ’å…¥å°ç»„ç»„é•¿åˆ†ç±»å…³è”ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯owner_user_idï¼‰
- `MigrateTradersOwnerUserID() error` - æ•°æ®è¿ç§»ï¼šè®¾ç½®ç°æœ‰äº¤æ˜“å‘˜çš„owner_user_id

### Phase 3: ç™»å½•é€»è¾‘ä¿®æ”¹ï¼ˆ1å¤©ï¼‰

#### 3.1 ä¿®æ”¹åç«¯ç™»å½•æ¥å£
**æ–‡ä»¶ï¼š** `api/server.go:1732` - `handleLogin` å‡½æ•°

**ä¿®æ”¹å†…å®¹ï¼š**
- æ ¹æ®ç”¨æˆ·è§’è‰²åˆ¤æ–­æ˜¯å¦éœ€è¦OTPéªŒè¯
- ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·ï¼ˆrole='admin'æˆ–'user'ï¼‰éœ€è¦OTPéªŒè¯
- åˆ›å»ºçš„è´¦å·ï¼ˆrole='group_leader'æˆ–'trader_account'ï¼‰ä¸éœ€è¦OTPï¼Œç›´æ¥ç™»å½•

#### 3.2 ä¿®æ”¹å‰ç«¯ç™»å½•é¡µé¢
**æ–‡ä»¶ï¼š** `web/src/components/LoginPage.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- ç™»å½•é¡µé¢ä¿æŒä¸å˜ï¼ˆéšæ€§åˆ¤æ–­ï¼‰
- æ ¹æ®APIè¿”å›çš„ `requires_otp` å­—æ®µå†³å®šæ˜¯å¦æ˜¾ç¤ºOTPè¾“å…¥æ¡†
- å¦‚æœ `requires_otp=false` æˆ–æ²¡æœ‰è¯¥å­—æ®µï¼Œç›´æ¥ç™»å½•æˆåŠŸ

**å…³é”®ä¿®æ”¹ï¼š**
```typescript
const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setLoading(true)

    const result = await login(email, password)

    if (result.success) {
        // å¦‚æœè¿”å›äº†tokenï¼Œè¯´æ˜æ˜¯æ™®é€šç”¨æˆ·ï¼Œç›´æ¥ç™»å½•æˆåŠŸ
        if (result.token) {
            // AuthContextä¼šè‡ªåŠ¨å¤„ç†
            return
        }
        
        // å¦‚æœéœ€è¦OTPéªŒè¯ï¼ˆç®¡ç†å‘˜ï¼‰
        if (result.requiresOTP && result.userID) {
            setUserID(result.userID)
            setStep('otp')
        }
    } else {
        setError(result.message || t('loginFailed', language))
    }

    setLoading(false)
}
```

#### 3.3 ä¿®æ”¹ AuthContext
**æ–‡ä»¶ï¼š** `web/src/contexts/AuthContext.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- `login` å‡½æ•°å¤„ç†ä¸¤ç§æƒ…å†µï¼š
  1. è¿”å›tokenï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼šç›´æ¥ç™»å½•
  2. è¿”å›requires_otpï¼ˆç®¡ç†å‘˜ï¼‰ï¼šè¿›å…¥OTPéªŒè¯æµç¨‹

### Phase 4: å‰ç«¯UIä¿®æ”¹ï¼ˆ1-2å¤©ï¼‰

#### 4.1 ä¿®æ”¹ AITradersPage.tsx
**æ–‡ä»¶ï¼š** `web/src/components/AITradersPage.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
1. ä»ç”¨æˆ·ä¿¡æ¯è·å–è§’è‰²
2. æ ¹æ®è§’è‰²æ¡ä»¶æ¸²æŸ“æ“ä½œæŒ‰é’®
3. æ·»åŠ åˆ›å»ºè´¦å·åŠŸèƒ½ï¼ˆæ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºtrader_accountå’Œgroup_leaderï¼‰

**å…³é”®ä¿®æ”¹ç‚¹ï¼š**
```typescript
// 1. è·å–ç”¨æˆ·è§’è‰²
const { user } = useAuth()
const userRole = user?.role || 'user'  // é»˜è®¤æ˜¯æ™®é€šç”¨æˆ·

// 2. åˆ¤æ–­æƒé™
const isUser = userRole === 'user'    // æ™®é€šç”¨æˆ·
const canEdit = isUser     // æ™®é€šç”¨æˆ·å¯ä»¥ç¼–è¾‘è‡ªå·±çš„äº¤æ˜“å‘˜
const canCreate = isUser   // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºäº¤æ˜“å‘˜ï¼ˆè‡ªå·±çš„åˆ†ç±»ï¼‰
const canDelete = isUser   // æ™®é€šç”¨æˆ·å¯ä»¥åˆ é™¤è‡ªå·±çš„äº¤æ˜“å‘˜
const canManageConfig = isUser  // é…ç½®åŠŸèƒ½ï¼ˆæ™®é€šç”¨æˆ·åªèƒ½é…ç½®è‡ªå·±çš„ï¼‰
const canCreateAccount = isUser      // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºäº¤æ˜“å‘˜è´¦å·
const canCreateGroupLeader = isUser  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºå°ç»„ç»„é•¿è´¦å·
const canManageCategories = isUser   // æ™®é€šç”¨æˆ·å¯ä»¥ç®¡ç†è‡ªå·±çš„åˆ†ç±»

// 3. æ¡ä»¶æ¸²æŸ“
{canCreate && <CreateButton />}
{canEdit && <EditButton />}
{canDelete && <DeleteButton />}
{canManageConfig && <ConfigButtons />}
{canCreateAccount && <CreateTraderAccountButton />}
{canCreateGroupLeader && <CreateGroupLeaderButton />}
{canManageCategories && <CategoryManagementButton />}
```

#### 4.2 æ·»åŠ åˆ›å»ºè´¦å·æ¨¡æ€æ¡†
**æ–‡ä»¶ï¼š** `web/src/components/AITradersPage.tsx`

**åŠŸèƒ½ï¼š**
- é€‰æ‹©è§’è‰²ï¼ˆtrader_account æˆ– group_leaderï¼‰
- **è´¦å·ç”Ÿæˆæ–¹å¼**ï¼šå¤é€‰æ¡†é€‰æ‹©æ˜¯å¦éšæœºç”Ÿæˆè´¦å·
  - â˜‘ï¸ éšæœºç”Ÿæˆè´¦å·ï¼šå‹¾é€‰åè‡ªåŠ¨ç”Ÿæˆè´¦å·ï¼Œéšè—è´¦å·è¾“å…¥æ¡†
  - â˜ æ‰‹åŠ¨è¾“å…¥è´¦å·ï¼šå–æ¶ˆå‹¾é€‰åæ˜¾ç¤ºè´¦å·è¾“å…¥æ¡†ï¼Œå¿…é¡»å¡«å†™
- **å¯†ç ç”Ÿæˆæ–¹å¼**ï¼šå¤é€‰æ¡†é€‰æ‹©æ˜¯å¦éšæœºç”Ÿæˆå¯†ç 
  - â˜‘ï¸ éšæœºç”Ÿæˆå¯†ç ï¼šå‹¾é€‰åè‡ªåŠ¨ç”Ÿæˆå¯†ç ï¼Œéšè—å¯†ç è¾“å…¥æ¡†
  - â˜ æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼šå–æ¶ˆå‹¾é€‰åæ˜¾ç¤ºå¯†ç è¾“å…¥æ¡†ï¼Œå¿…é¡»å¡«å†™
- å¦‚æœgroup_leaderï¼Œæ˜¾ç¤ºåˆ†ç±»é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰
- åˆ›å»ºæˆåŠŸåæ˜¾ç¤ºç”Ÿæˆçš„è´¦å·å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰

**å››ç§ç»„åˆæ¨¡å¼UIç¤ºä¾‹ï¼š**
```typescript
// åˆ›å»ºè´¦å·æ¨¡æ€æ¡†ç»„ä»¶
const CreateAccountModal = ({ traderId, role, onClose }) => {
  const [generateRandomEmail, setGenerateRandomEmail] = useState(true)
  const [generateRandomPassword, setGenerateRandomPassword] = useState(true)
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [categories, setCategories] = useState([])  // group_leaderç”¨
  
  const handleSubmit = async () => {
    // éªŒè¯å¿…å¡«å­—æ®µ
    if (!generateRandomEmail && !email) {
      alert('è¯·è¾“å…¥è´¦å·')
      return
    }
    if (!generateRandomPassword && !password) {
      alert('è¯·è¾“å…¥å¯†ç ')
      return
    }
    
    const payload = {
      generate_random_email: generateRandomEmail,
      generate_random_password: generateRandomPassword,
      email: generateRandomEmail ? undefined : email,
      password: generateRandomPassword ? undefined : password,
      ...(role === 'group_leader' && { categories })
    }
    
    // è°ƒç”¨APIåˆ›å»ºè´¦å·
    const result = await createAccount(traderId, role, payload)
    
    // æ˜¾ç¤ºç”Ÿæˆçš„è´¦å·å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
    if (result.success) {
      alert(`è´¦å·åˆ›å»ºæˆåŠŸï¼\nè´¦å·: ${result.email}\nå¯†ç : ${result.password}`)
      onClose()
    }
  }
  
  return (
    <Modal>
      <h3>åˆ›å»º{role === 'trader_account' ? 'äº¤æ˜“å‘˜è´¦å·' : 'å°ç»„ç»„é•¿è´¦å·'}</h3>
      
      {/* è´¦å·ç”Ÿæˆæ–¹å¼ */}
      <div>
        <label>
          <input
            type="checkbox"
            checked={generateRandomEmail}
            onChange={(e) => setGenerateRandomEmail(e.target.checked)}
          />
          éšæœºç”Ÿæˆè´¦å·
        </label>
        {!generateRandomEmail && (
          <input
            type="email"
            placeholder="è¯·è¾“å…¥è´¦å·ï¼ˆé‚®ç®±ï¼‰"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
          />
        )}
      </div>
      
      {/* å¯†ç ç”Ÿæˆæ–¹å¼ */}
      <div>
        <label>
          <input
            type="checkbox"
            checked={generateRandomPassword}
            onChange={(e) => setGenerateRandomPassword(e.target.checked)}
          />
          éšæœºç”Ÿæˆå¯†ç 
        </label>
        {!generateRandomPassword && (
          <input
            type="password"
            placeholder="è¯·è¾“å…¥å¯†ç "
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            required
          />
        )}
      </div>
      
      {/* å¦‚æœæ˜¯group_leaderï¼Œæ˜¾ç¤ºåˆ†ç±»é€‰æ‹© */}
      {role === 'group_leader' && (
        <div>
          <label>é€‰æ‹©åˆ†ç±»ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</label>
          <select multiple value={categories} onChange={(e) => setCategories([...e.target.selectedOptions].map(o => o.value))}>
            {/* åˆ†ç±»é€‰é¡¹ */}
          </select>
        </div>
      )}
      
      <button onClick={handleSubmit}>åˆ›å»º</button>
      <button onClick={onClose}>å–æ¶ˆ</button>
    </Modal>
  )
}
```

#### 4.3 ä¿®æ”¹ App.tsx - TraderDetailsPage
**æ–‡ä»¶ï¼š** `web/src/App.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- æ ¹æ®è§’è‰²éšè—ç¼–è¾‘åŠŸèƒ½ï¼ˆå¦‚æœéœ€è¦ï¼‰
- **äº¤æ˜“å‘˜ä¸‹æ‹‰åˆ—è¡¨æ— éœ€ä¿®æ”¹**ï¼ˆè‡ªåŠ¨é€‚é…ï¼‰

### Phase 5: æ–°å¢åŠŸèƒ½APIï¼ˆ1-2å¤©ï¼‰

#### 5.1 åˆ›å»ºäº¤æ˜“å‘˜è´¦å·API
**æ–‡ä»¶ï¼š** `api/server.go` - æ–°å¢ `handleCreateTraderAccount` å’Œ `handleCreateGroupLeader` å‡½æ•°

**åŠŸèƒ½ï¼š**
- ä¸ºäº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆtrader_accountï¼‰
- ä¸ºåˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆgroup_leaderï¼‰
- æ”¯æŒéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥
- è¿”å›è´¦å·ä¿¡æ¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰
- å¿…é¡»éªŒè¯äº¤æ˜“å‘˜/åˆ†ç±»çš„owner_user_idä¸å½“å‰ç”¨æˆ·IDåŒ¹é…

#### 5.2 æ•°æ®åº“æ–¹æ³•
**æ–‡ä»¶ï¼š** `config/database.go`

**æ–°å¢æ–¹æ³•ï¼š**
- `UpdateTraderAccountID(traderID, accountID string) error` - æ›´æ–°äº¤æ˜“å‘˜çš„è´¦å·ID
- `InsertGroupLeaderCategory(groupLeaderID, category, ownerUserID string) error` - æ’å…¥å°ç»„ç»„é•¿åˆ†ç±»å…³è”ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯owner_user_idï¼Œå¿…é¡»è®¾ç½®ä¸ºåˆ›å»ºè€…çš„ç”¨æˆ·IDï¼‰
- `GetGroupLeaderCategories(userID string) ([]string, error)` - è·å–å°ç»„ç»„é•¿å¯ä»¥è§‚æµ‹çš„åˆ†ç±»
- `GetTraderByID(traderID string) (*TraderRecord, error)` - è·å–äº¤æ˜“å‘˜ä¿¡æ¯ï¼ˆåŒ…å«owner_user_idå’Œcategoryï¼‰
- `GetTradersByOwnerUserID(userID string) ([]*TraderRecord, error)` - æ ¹æ®owner_user_idè·å–äº¤æ˜“å‘˜åˆ—è¡¨ï¼ˆç”¨äºå‘åå…¼å®¹ï¼‰
- `UpdateTradersCategoryToEmpty(categoryName string) error` - å°†æŒ‡å®šåˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜çš„categoryè®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆåˆ é™¤åˆ†ç±»æ—¶ä½¿ç”¨ï¼‰
- `MigrateTradersOwnerUserID() error` - æ•°æ®è¿ç§»ï¼šè®¾ç½®ç°æœ‰äº¤æ˜“å‘˜çš„owner_user_idï¼ˆSQLiteéœ€è¦ä»£ç å¤„ç†ï¼‰

### Phase 6: æµ‹è¯•ï¼ˆ1å¤©ï¼‰

1. **æƒé™æµ‹è¯•**
   - æµ‹è¯•å„è§’è‰²çš„äº¤æ˜“å‘˜åˆ—è¡¨è¿‡æ»¤
   - æµ‹è¯•UIæŒ‰é’®æ˜¾ç¤º/éšè—
   - æµ‹è¯•äº¤æ˜“å‘˜ä¸‹æ‹‰åˆ—è¡¨

2. **å‘åå…¼å®¹æµ‹è¯•**
   - ç¡®ä¿ç°æœ‰ç”¨æˆ·ï¼ˆæ— roleå­—æ®µï¼‰æ­£å¸¸å·¥ä½œ
   - ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

---

## ğŸ“ ä»£ç ç»“æ„ï¼ˆæœ€å°åŒ–ä¿®æ”¹ç‰ˆï¼‰

### åç«¯æ–‡ä»¶ç»“æ„

```
nofx/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ server.go                    # ä¿®æ”¹ï¼šhandleTraderList, handleAccount
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ auth.go                      # æ— éœ€ä¿®æ”¹ï¼ˆæˆ–æ·»åŠ è§’è‰²å¸¸é‡ï¼‰
â””â”€â”€ config/
    â””â”€â”€ database.go                  # ä¿®æ”¹ï¼šæ·»åŠ è§’è‰²æŸ¥è¯¢æ–¹æ³•
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- âœ… `api/server.go` - 4ä¸ªå‡½æ•°ä¿®æ”¹ï¼ˆhandleTraderList, handleLogin, handleRegister, handleCreateTraderAccountï¼‰
- âœ… `config/database.go` - æ·»åŠ å‡ ä¸ªæŸ¥è¯¢æ–¹æ³•

### å‰ç«¯æ–‡ä»¶ç»“æ„

```
web/src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ AITradersPage.tsx            # ä¿®æ”¹ï¼šæ·»åŠ æ¡ä»¶æ¸²æŸ“
â”œâ”€â”€ App.tsx                          # ä¿®æ”¹ï¼šTraderDetailsPage æ·»åŠ æ¡ä»¶æ¸²æŸ“ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ contexts/
    â””â”€â”€ AuthContext.tsx              # ä¿®æ”¹ï¼šç¡®ä¿åŒ…å«roleå­—æ®µï¼ˆå¯é€‰ï¼‰
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- âœ… `web/src/components/AITradersPage.tsx` - æ·»åŠ æ¡ä»¶æ¸²æŸ“ + åˆ›å»ºè´¦å·åŠŸèƒ½
- âœ… `web/src/components/LoginPage.tsx` - ä¿®æ”¹ç™»å½•é€»è¾‘ï¼ˆéšæ€§åˆ¤æ–­ï¼‰
- âœ… `web/src/contexts/AuthContext.tsx` - ä¿®æ”¹loginå‡½æ•°å¤„ç†ä¸¤ç§ç™»å½•æ–¹å¼
- âœ… `web/src/App.tsx` - å¯é€‰ä¿®æ”¹ï¼ˆå¦‚æœéœ€è¦éšè—è¯¦æƒ…é¡µç¼–è¾‘åŠŸèƒ½ï¼‰

**æ— éœ€æ–°å¢æ–‡ä»¶ï¼š**
- âŒ ä¸éœ€è¦æ–°çš„é¡µé¢ç»„ä»¶
- âŒ ä¸éœ€è¦æ–°çš„APIå¤„ç†æ–‡ä»¶
- âŒ ä¸éœ€è¦æ–°çš„æƒé™ä¸­é—´ä»¶

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **æƒé™éªŒè¯**
   - æ‰€æœ‰APIå¿…é¡»åœ¨åç«¯éªŒè¯æƒé™
   - å‰ç«¯æƒé™æ§åˆ¶ä»…ç”¨äºUIå±•ç¤ºï¼Œä¸èƒ½ä½œä¸ºå®‰å…¨ä¾æ®

2. **æ•°æ®éš”ç¦»**
   - äº¤æ˜“å‘˜è´¦å·åªèƒ½è®¿é—®è‡ªå·±çš„äº¤æ˜“å‘˜æ•°æ®
   - å°ç»„ç»„é•¿åªèƒ½è®¿é—®ç®¡ç†çš„åˆ†ç±»å†…çš„äº¤æ˜“å‘˜æ•°æ®
   - ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢çº§åˆ«çš„æƒé™è¿‡æ»¤

3. **è´¦å·ç®¡ç†**
   - æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºè‡ªå·±åˆ›å»ºè´¦å·ï¼ˆtrader_accountå’Œgroup_leaderï¼‰
   - å¿…é¡»éªŒè¯äº¤æ˜“å‘˜/åˆ†ç±»çš„owner_user_idä¸å½“å‰ç”¨æˆ·IDåŒ¹é…
   - è´¦å·å¯†ç è‡ªåŠ¨ç”Ÿæˆæ—¶ï¼Œéœ€è¦å®‰å…¨éšæœºç”Ÿæˆ
   - è´¦å·åˆ›å»ºåéœ€è¦è®°å½•å®¡è®¡æ—¥å¿—

4. **åªè¯»æ¨¡å¼**
   - å°ç»„ç»„é•¿å’Œäº¤æ˜“å‘˜è´¦å·çš„æ‰€æœ‰é…ç½®åŠŸèƒ½å¿…é¡»åœ¨åç«¯å’Œå‰ç«¯éƒ½éšè—
   - å³ä½¿ç»•è¿‡å‰ç«¯ï¼Œåç«¯APIä¹Ÿåº”è¯¥æ‹’ç»ç¼–è¾‘è¯·æ±‚

---

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### æ™®é€šç”¨æˆ·åˆ›å»ºäº¤æ˜“å‘˜è´¦å·

```
1. å‰ç«¯è¯·æ±‚: POST /api/traders/trader123/create-account
   Body: { "generate_random": true }
2. åç«¯ä¸­é—´ä»¶: æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º user
3. æƒé™æ£€æŸ¥: éªŒè¯äº¤æ˜“å‘˜çš„owner_user_idæ˜¯å¦ä¸å½“å‰ç”¨æˆ·IDåŒ¹é…
4. åˆ›å»ºç”¨æˆ·: INSERT INTO users (id, email, role='trader_account', trader_id, category)
5. æ›´æ–°äº¤æ˜“å‘˜: UPDATE traders SET trader_account_id = new_user_id
6. ç”Ÿæˆå¯†ç : è‡ªåŠ¨ç”Ÿæˆå®‰å…¨å¯†ç 
7. è¿”å›å“åº”: { user_id, email, password, trader_id }
8. å‰ç«¯å±•ç¤º: æ˜¾ç¤ºè´¦å·ä¿¡æ¯å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
```

### æ™®é€šç”¨æˆ·åˆ›å»ºå°ç»„ç»„é•¿è´¦å·

```
1. å‰ç«¯è¯·æ±‚: POST /api/group-leaders/create
   Body: { "generate_random": true, "categories": ["Group A"] }
2. åç«¯ä¸­é—´ä»¶: æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º user
3. æƒé™æ£€æŸ¥: éªŒè¯åˆ†ç±»æ˜¯å¦å±äºå½“å‰ç”¨æˆ·ï¼ˆé€šè¿‡categoriesè¡¨çš„owner_user_idï¼‰
4. åˆ›å»ºç”¨æˆ·: INSERT INTO users (id, email, role='group_leader')
5. å…³è”åˆ†ç±»: INSERT INTO group_leader_categories (group_leader_id, category, owner_user_id)
6. ç”Ÿæˆå¯†ç : è‡ªåŠ¨ç”Ÿæˆå®‰å…¨å¯†ç 
7. è¿”å›å“åº”: { user_id, email, password, categories }
8. å‰ç«¯å±•ç¤º: æ˜¾ç¤ºè´¦å·ä¿¡æ¯å’Œå¯†ç ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
```

### å°ç»„ç»„é•¿æŸ¥çœ‹äº¤æ˜“å‘˜åˆ—è¡¨

```
1. å‰ç«¯è¯·æ±‚: GET /api/traders
2. åç«¯ä¸­é—´ä»¶: æ£€æŸ¥ç”¨æˆ·è§’è‰²ä¸º group_leader
3. æƒé™æ£€æŸ¥: è·å–è¯¥å°ç»„ç»„é•¿ç®¡ç†çš„åˆ†ç±»åˆ—è¡¨
4. æ•°æ®åº“æŸ¥è¯¢: SELECT * FROM traders WHERE category IN (ç®¡ç†çš„åˆ†ç±»åˆ—è¡¨)
5. è¿”å›å“åº”: { traders: [...], can_edit: false }
6. å‰ç«¯å±•ç¤º: åªè¯»æ¨¡å¼ï¼Œéšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®
```

### äº¤æ˜“å‘˜è´¦å·æŸ¥çœ‹è‡ªå·±çš„äº¤æ˜“å‘˜

```
1. å‰ç«¯è¯·æ±‚: GET /api/traders
2. åç«¯ä¸­é—´ä»¶: æ£€æŸ¥ç”¨æˆ·è§’è‰²ä¸º trader_account
3. æƒé™æ£€æŸ¥: è·å–å…³è”çš„äº¤æ˜“å‘˜ID (trader_id)
4. æ•°æ®åº“æŸ¥è¯¢: SELECT * FROM traders WHERE id = trader_id
5. è¿”å›å“åº”: { traders: [å•ä¸ªäº¤æ˜“å‘˜], can_edit: false }
6. å‰ç«¯å±•ç¤º: åªè¯»æ¨¡å¼ï¼Œéšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å››çº§æƒé™ä½“ç³»ï¼ˆAdmin / User / Group Leader / Trader Accountï¼‰
- âœ… **ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ä¸‰çº§æƒé™ä½“ç³»ï¼ˆUser / Group Leader / Trader Accountï¼‰**
- âœ… Adminè§’è‰²ä¿ç•™ä½†ä¸å¸¸ç”¨ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰äº¤æ˜“å‘˜ï¼‰
- âœ… äº¤æ˜“å‘˜åˆ†ç±»ç®¡ç†ï¼ˆUserå¯ä»¥åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„åˆ†ç±»ï¼‰
- âœ… äº¤æ˜“å‘˜è´¦å·åˆ›å»ºå’Œç®¡ç†ï¼ˆUserå¯ä»¥ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼‰
- âœ… å°ç»„ç»„é•¿è´¦å·åˆ›å»ºå’Œç®¡ç†ï¼ˆUserå¯ä»¥ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼‰
- âœ… æ•°æ®éš”ç¦»å’Œæƒé™æ§åˆ¶ï¼ˆUseråªèƒ½ç®¡ç†è‡ªå·±çš„æ•°æ®ï¼‰
- âœ… åªè¯»æ¨¡å¼ï¼ˆGroup Leaderå’ŒTrader Accountéšè—é…ç½®åŠŸèƒ½ï¼‰

### æŠ€æœ¯è¦ç‚¹
- âœ… æ•°æ®åº“æ‰©å±•ï¼ˆè§’è‰²å­—æ®µã€åˆ†ç±»å­—æ®µã€è´¦å·å…³è”ï¼‰
- âœ… åç«¯æƒé™ä¸­é—´ä»¶
- âœ… å‰ç«¯è§’è‰²æ„ŸçŸ¥UIï¼ˆæ˜¾ç¤º/éšè—åŠŸèƒ½ï¼‰
- âœ… APIæƒé™éªŒè¯

### é¢„ä¼°æ—¶é—´ï¼ˆæœ€å°åŒ–ä¿®æ”¹ç‰ˆï¼‰
- **æ•°æ®åº“æ‰©å±•**: 1å¤©
- **åç«¯APIä¿®æ”¹**: 1-2å¤©ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šhandleRegister, handleTraderList, handleLoginï¼‰
- **ç™»å½•é€»è¾‘ä¿®æ”¹**: 1å¤©ï¼ˆåç«¯+å‰ç«¯ï¼‰
- **åˆ›å»ºè´¦å·åŠŸèƒ½**: 1-2å¤©ï¼ˆAPI + å‰ç«¯UIï¼‰
- **å‰ç«¯UIä¿®æ”¹**: 1-2å¤©ï¼ˆä¸»è¦æ˜¯æ¡ä»¶æ¸²æŸ“ï¼‰
- **æµ‹è¯•**: 1å¤©
- **æ€»è®¡**: 6-9å¤©

**å¯¹æ¯”åŸæ–¹æ¡ˆï¼š**
- âœ… å‡å°‘50%çš„å¼€å‘æ—¶é—´
- âœ… æœ€å°åŒ–ä»£ç ä¿®æ”¹
- âœ… å¤ç”¨ç°æœ‰ç»„ä»¶å’Œé€»è¾‘
- âœ… é™ä½å¼•å…¥bugçš„é£é™©

---

## ğŸ¯ æœ€å°åŒ–ä¿®æ”¹æ–¹æ¡ˆæ€»ç»“

### æ ¸å¿ƒæ€è·¯

1. **åç«¯è¿‡æ»¤æ•°æ®**
   - ä¿®æ”¹ `handleTraderList` å‡½æ•°ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²è¿”å›ä¸åŒçš„äº¤æ˜“å‘˜åˆ—è¡¨
   - `admin` â†’ æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼Œç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
   - `user` â†’ è‡ªå·±åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜ï¼ˆæ•°æ®éš”ç¦»ï¼‰
   - `group_leader` â†’ è§‚æµ‹çš„åˆ†ç±»å†…çš„äº¤æ˜“å‘˜ï¼ˆåˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼‰
   - `trader_account` â†’ è‡ªå·±çš„äº¤æ˜“å‘˜
   - å“åº”æ ¼å¼ä¿æŒä¸å˜ï¼Œå‰ç«¯æ— éœ€ä¿®æ”¹

2. **æ³¨å†Œæ—¶è®¾ç½®è§’è‰²**
   - ä¿®æ”¹ `handleRegister` å‡½æ•°ï¼Œæ³¨å†Œæ—¶è®¾ç½® `role='user'`
   - ç¡®ä¿æ³¨å†Œçš„ç”¨æˆ·å¯ä»¥åˆ›å»ºåˆ†ç±»å’Œç®¡ç†è‡ªå·±çš„äº¤æ˜“å‘˜

3. **ç™»å½•é€»è¾‘éšæ€§åˆ¤æ–­**
   - ä¿®æ”¹ `handleLogin` å‡½æ•°ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²å†³å®šæ˜¯å¦éœ€è¦OTPéªŒè¯
   - `admin` å’Œ `user` éœ€è¦OTPï¼ˆæ³¨å†Œç”¨æˆ·ï¼‰
   - `group_leader` å’Œ `trader_account` ä¸éœ€è¦OTPï¼ˆåˆ›å»ºçš„è´¦å·ï¼‰
   - ç™»å½•é¡µé¢çœ‹èµ·æ¥ä¸€æ ·ï¼Œåç«¯è‡ªåŠ¨åˆ¤æ–­

4. **å‰ç«¯éšè—æ“ä½œ**
   - åœ¨ `AITradersPage.tsx` ä¸­æ ¹æ®ç”¨æˆ·è§’è‰²æ¡ä»¶æ¸²æŸ“æ“ä½œæŒ‰é’®
   - æ™®é€šç”¨æˆ·å¯ä»¥çœ‹åˆ°åˆ›å»º/ç¼–è¾‘/åˆ é™¤æŒ‰é’®ï¼ˆä½†åªèƒ½æ“ä½œè‡ªå·±çš„äº¤æ˜“å‘˜ï¼‰
   - æ™®é€šç”¨æˆ·å¯ä»¥çœ‹åˆ°è´¦å·ç®¡ç†å’Œåˆ†ç±»ç®¡ç†åŠŸèƒ½ï¼ˆä½†åªèƒ½ç®¡ç†è‡ªå·±çš„ï¼‰

5. **äº¤æ˜“å‘˜ä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨é€‚é…**
   - ä¸‹æ‹‰åˆ—è¡¨ä½¿ç”¨ `traders` æ•°ç»„ï¼ˆå·²ç”±APIè¿‡æ»¤ï¼‰
   - **æ— éœ€ä¿®æ”¹**ï¼šç°æœ‰ä»£ç å·²ç»æ»¡è¶³éœ€æ±‚

6. **è´¦å·åˆ›å»ºåŠŸèƒ½**
   - Adminå¯ä»¥ä¸ºæ‰€æœ‰äº¤æ˜“å‘˜å’Œåˆ†ç±»åˆ›å»ºè´¦å·ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
   - æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆtrader_accountï¼‰
   - æ™®é€šç”¨æˆ·å¯ä»¥ä¸ºè‡ªå·±çš„åˆ†ç±»åˆ›å»ºå°ç»„ç»„é•¿è´¦å·ï¼ˆgroup_leaderï¼‰
   - æ”¯æŒéšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥ç”¨æˆ·åå¯†ç 
   - åˆ›å»ºçš„è´¦å·ä¸éœ€è¦OTPè®¾ç½®

### å…³é”®ä¼˜åŠ¿

- âœ… **æœ€å°åŒ–ä¿®æ”¹**ï¼šåªä¿®æ”¹2-3ä¸ªæ–‡ä»¶
- âœ… **å¤ç”¨ç°æœ‰ä»£ç **ï¼šäº¤æ˜“å‘˜åˆ‡æ¢åŠŸèƒ½å®Œå…¨å¤ç”¨
- âœ… **å‘åå…¼å®¹**ï¼šç°æœ‰ç”¨æˆ·é»˜è®¤æ˜¯userï¼Œå¯ä»¥åˆ›å»ºåˆ†ç±»å’Œè´¦å·
- âœ… **æ•°æ®ä¿ç•™**ï¼šæ‰€æœ‰æ•°æ®åº“è¿ç§»ä½¿ç”¨ALTER TABLEï¼Œå®Œå…¨ä¿ç•™ç°æœ‰æ•°æ®
- âœ… **å¼€å‘å¿«é€Ÿ**ï¼š4-6å¤©å³å¯å®Œæˆæ ¸å¿ƒåŠŸèƒ½

### ä¿®æ”¹æ¸…å•

**åç«¯ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰ï¼š**
1. `api/server.go` - ä¿®æ”¹ `handleTraderList` å’Œ `handleAccount`
2. `config/database.go` - æ·»åŠ å‡ ä¸ªæŸ¥è¯¢æ–¹æ³•

**å‰ç«¯ï¼ˆ1-2ä¸ªæ–‡ä»¶ï¼‰ï¼š**
1. `web/src/components/AITradersPage.tsx` - æ·»åŠ æ¡ä»¶æ¸²æŸ“
2. `web/src/App.tsx` - å¯é€‰ä¿®æ”¹ï¼ˆå¦‚æœéœ€è¦ï¼‰

**æ•°æ®åº“ï¼ˆ3ä¸ªALTER + 1ä¸ªCREATEï¼‰ï¼š**
1. `users` è¡¨æ·»åŠ  `role` å’Œ `trader_id` å­—æ®µ
2. `traders` è¡¨æ·»åŠ  `category` å’Œ `trader_account_id` å­—æ®µ
3. åˆ›å»º `group_leader_categories` è¡¨

---

## ğŸ“Œ å…³é”®å®ç°ç»†èŠ‚

### 1. å¯†ç ç”Ÿæˆç­–ç•¥

```go
// ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†ç 
func generatePassword(length int) string {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*"
    b := make([]byte, length)
    for i := range b {
        b[i] = charset[rand.Intn(len(charset))]
    }
    return string(b)
}
```

### 2. å‰ç«¯æƒé™æ£€æŸ¥

```typescript
// æ ¹æ®è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
const canEdit = user?.role === 'user';  // æ™®é€šç”¨æˆ·å¯ä»¥ç¼–è¾‘è‡ªå·±çš„äº¤æ˜“å‘˜
const canCreateAccount = user?.role === 'user';  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºäº¤æ˜“å‘˜è´¦å·
const canCreateGroupLeader = user?.role === 'user';  // æ™®é€šç”¨æˆ·å¯ä»¥åˆ›å»ºå°ç»„ç»„é•¿è´¦å·
const canManageCategories = user?.role === 'user';  // æ™®é€šç”¨æˆ·å¯ä»¥ç®¡ç†è‡ªå·±çš„åˆ†ç±»

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
{canEdit && <EditButton />}
{canCreateAccount && <CreateTraderAccountButton />}
{canCreateGroupLeader && <CreateGroupLeaderButton />}
{canManageCategories && <CategoryManagementButton />}
```

### 3. åç«¯æƒé™æ£€æŸ¥

```go
// æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®äº¤æ˜“å‘˜
func canAccessTrader(userID string, role string, traderID string) bool {
    switch role {
    case "admin":
        // ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆç‰¹æ®Šè§’è‰²ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
        return true
    case "user":
        // æ£€æŸ¥äº¤æ˜“å‘˜çš„owner_user_idæ˜¯å¦ä¸å½“å‰ç”¨æˆ·IDåŒ¹é…
        trader, _ := s.database.GetTraderByID(traderID)
        return trader != nil && trader.OwnerUserID == userID
    case "group_leader":
        // æ£€æŸ¥äº¤æ˜“å‘˜æ˜¯å¦åœ¨ç®¡ç†çš„åˆ†ç±»å†…ï¼ˆåˆ›å»ºè€…æŒ‡å®šçš„åˆ†ç±»ï¼‰
        return isTraderInManagedCategories(userID, traderID)
    case "trader_account":
        // æ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå·±çš„äº¤æ˜“å‘˜
        return isOwnTrader(userID, traderID)
    default:
        return false
    }
}
```

---

## ğŸ“Œ åç»­æ‰©å±•

1. **å¯†ç é‡ç½®åŠŸèƒ½**
   - æ™®é€šç”¨æˆ·å¯ä»¥é‡ç½®è‡ªå·±åˆ›å»ºçš„äº¤æ˜“å‘˜è´¦å·å¯†ç 
   - æ™®é€šç”¨æˆ·å¯ä»¥é‡ç½®è‡ªå·±åˆ›å»ºçš„å°ç»„ç»„é•¿å¯†ç 

2. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡è®¾ç½®äº¤æ˜“å‘˜åˆ†ç±»ï¼ˆåªèƒ½è®¾ç½®åˆ°è‡ªå·±çš„åˆ†ç±»ï¼‰
   - æ‰¹é‡åˆ›å»ºäº¤æ˜“å‘˜è´¦å·ï¼ˆåªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºï¼‰

3. **é€šçŸ¥ç³»ç»Ÿ**
   - äº¤æ˜“å‘˜è´¦å·æ¥æ”¶è‡ªå·±çš„äº¤æ˜“å‘˜çŠ¶æ€å˜åŒ–é€šçŸ¥
   - å°ç»„ç»„é•¿æ¥æ”¶ç®¡ç†çš„äº¤æ˜“å‘˜çŠ¶æ€å˜åŒ–é€šçŸ¥

4. **æ•°æ®å¯¼å‡º**
   - å°ç»„ç»„é•¿å¯¼å‡ºç®¡ç†çš„äº¤æ˜“å‘˜æ•°æ®
   - äº¤æ˜“å‘˜è´¦å·å¯¼å‡ºè‡ªå·±çš„äº¤æ˜“å‘˜æ•°æ®

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

### 1. æ•°æ®åº“è¿ç§»é”™è¯¯å¤„ç†

**åœºæ™¯ï¼š** æ•°æ®åº“è¿ç§»å¤±è´¥æˆ–éƒ¨åˆ†å¤±è´¥

**å¤„ç†ç­–ç•¥ï¼š**
```go
// åœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶æ‰§è¡Œè¿ç§»ï¼Œå¹¶è®°å½•é”™è¯¯
func (d *Database) MigrateSchema() error {
    migrations := []struct {
        name string
        fn   func() error
    }{
        {"add_user_role", d.migrateAddUserRole},
        {"add_trader_category", d.migrateAddTraderCategory},
        {"create_categories_table", d.migrateCreateCategoriesTable},
        {"create_group_leader_categories_table", d.migrateCreateGroupLeaderCategoriesTable},
        {"migrate_traders_owner_user_id", d.migrateTradersOwnerUserID},
    }
    
    for _, migration := range migrations {
        if err := migration.fn(); err != nil {
            log.Printf("è¿ç§»å¤±è´¥: %s, é”™è¯¯: %v", migration.name, err)
            // è®°å½•å¤±è´¥ä½†ä¸ä¸­æ–­ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–è¿ç§»
            // è¿”å›é”™è¯¯ï¼Œè®©è°ƒç”¨è€…å†³å®šå¦‚ä½•å¤„ç†
            return fmt.Errorf("è¿ç§» %s å¤±è´¥: %w", migration.name, err)
        }
    }
    return nil
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ¯ä¸ªè¿ç§»æ­¥éª¤ç‹¬ç«‹æ‰§è¡Œï¼Œå¤±è´¥ä¸å½±å“å…¶ä»–æ­¥éª¤
- âœ… è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥
- âœ… æ”¯æŒé‡å¤æ‰§è¡Œï¼ˆä½¿ç”¨ `IF NOT EXISTS` æˆ–æ£€æŸ¥è¡¨ç»“æ„ï¼‰

### 2. è§’è‰²å­—æ®µä¸ºç©ºçš„æƒ…å†µ

**åœºæ™¯ï¼š** ç°æœ‰ç”¨æˆ·æ²¡æœ‰ `role` å­—æ®µæˆ–å­—æ®µä¸ºç©º

**å¤„ç†ç­–ç•¥ï¼š**
```go
// è·å–ç”¨æˆ·è§’è‰²æ—¶ï¼Œå¦‚æœä¸ºç©ºåˆ™é»˜è®¤ä¸º 'user'
func (d *Database) GetUserRole(userID string) (string, error) {
    user, err := d.GetUserByID(userID)
    if err != nil {
        return "", err
    }
    
    role := user.Role
    if role == "" {
        // å‘åå…¼å®¹ï¼šé»˜è®¤ä¸ºæ™®é€šç”¨æˆ·
        role = "user"
        // å¯é€‰ï¼šæ›´æ–°æ•°æ®åº“ä¸­çš„roleå­—æ®µ
        // d.UpdateUserRole(userID, "user")
    }
    
    return role, nil
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… é»˜è®¤å€¼å¤„ç†ï¼šç©ºå€¼é»˜è®¤ä¸º `'user'`
- âœ… å‘åå…¼å®¹ï¼šä¸å½±å“ç°æœ‰ç”¨æˆ·
- âœ… å¯é€‰è‡ªåŠ¨ä¿®å¤ï¼šå¯ä»¥è‡ªåŠ¨æ›´æ–°ç©ºå€¼

### 3. äº¤æ˜“å‘˜ owner_user_id ä¸ºç©ºçš„æƒ…å†µ

**åœºæ™¯ï¼š** ç°æœ‰äº¤æ˜“å‘˜æ²¡æœ‰ `owner_user_id` å­—æ®µ

**å¤„ç†ç­–ç•¥ï¼š**
```go
// åœ¨æŸ¥è¯¢äº¤æ˜“å‘˜åˆ—è¡¨æ—¶ï¼Œå¤„ç†owner_user_idä¸ºç©ºçš„æƒ…å†µ
func (d *Database) GetTradersByOwnerUserID(userID string) ([]*TraderRecord, error) {
    // æŸ¥è¯¢owner_user_idä¸ºè¯¥ç”¨æˆ·çš„äº¤æ˜“å‘˜
    query := `SELECT * FROM traders WHERE owner_user_id = ?`
    rows, err := d.db.Query(query, userID)
    // ... å¤„ç†ç»“æœ
    
    // å‘åå…¼å®¹ï¼šå¦‚æœowner_user_idä¸ºç©ºï¼Œå¯ä»¥é€šè¿‡user_idå…³è”
    // ä½†è¿™ä¸æ˜¯æ¨èçš„åšæ³•ï¼Œåº”è¯¥é€šè¿‡è¿ç§»è„šæœ¬è®¾ç½®owner_user_id
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ•°æ®è¿ç§»ï¼šä¼˜å…ˆé€šè¿‡è¿ç§»è„šæœ¬è®¾ç½® `owner_user_id`
- âœ… æŸ¥è¯¢å…¼å®¹ï¼šå¦‚æœè¿ç§»ä¸å®Œæ•´ï¼Œå¯ä»¥é€šè¿‡å…¶ä»–å­—æ®µå…³è”
- âœ… æ–°åˆ›å»ºçš„äº¤æ˜“å‘˜å¿…é¡»è®¾ç½® `owner_user_id`

### 4. åˆ†ç±»åˆ é™¤æ—¶çš„çº§è”å¤„ç†

**åœºæ™¯ï¼š** åˆ é™¤åˆ†ç±»æ—¶ï¼Œå…³è”çš„äº¤æ˜“å‘˜å’Œå°ç»„ç»„é•¿å¦‚ä½•å¤„ç†

**å¤„ç†ç­–ç•¥ï¼š**
```go
func (s *Server) handleDeleteCategory(c *gin.Context) {
    // ... æƒé™æ£€æŸ¥ ...
    
    categoryName := category.Name
    
    // 1. æ£€æŸ¥æ˜¯å¦æœ‰äº¤æ˜“å‘˜ä½¿ç”¨è¯¥åˆ†ç±»
    traders, _ := s.database.GetTradersByCategory(categoryName)
    if len(traders) > 0 {
        // å°†äº¤æ˜“å‘˜çš„categoryè®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆä¸åˆ é™¤äº¤æ˜“å‘˜ï¼‰
        err = s.database.UpdateTradersCategoryToEmpty(categoryName)
        if err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{"error": "æ›´æ–°äº¤æ˜“å‘˜åˆ†ç±»å¤±è´¥"})
            return
        }
    }
    
    // 2. åˆ é™¤åˆ†ç±»ï¼ˆä¼šè‡ªåŠ¨åˆ é™¤group_leader_categoriesä¸­çš„å…³è”ï¼Œé€šè¿‡FOREIGN KEY CASCADEï¼‰
    err = s.database.DeleteCategory(categoryID)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": "åˆ é™¤åˆ†ç±»å¤±è´¥"})
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "message": "åˆ†ç±»åˆ é™¤æˆåŠŸ",
        "affected_traders": len(traders),
    })
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… äº¤æ˜“å‘˜ä¸åˆ é™¤ï¼šåªæ¸…ç©º `category` å­—æ®µ
- âœ… å°ç»„ç»„é•¿å…³è”è‡ªåŠ¨åˆ é™¤ï¼šé€šè¿‡ FOREIGN KEY CASCADE
- âœ… è¿”å›å—å½±å“çš„æ•°æ®æ•°é‡ï¼Œä¾¿äºå‰ç«¯æç¤º

### 5. è´¦å·åˆ›å»ºæ—¶çš„é‚®ç®±å†²çª

**åœºæ™¯ï¼š** åˆ›å»ºè´¦å·æ—¶ï¼Œé‚®ç®±å·²å­˜åœ¨

**å¤„ç†ç­–ç•¥ï¼š**
```go
func (s *Server) handleCreateTraderAccount(c *gin.Context) {
    // ... æƒé™æ£€æŸ¥ ...
    
    var accountEmail string
    if req.GenerateRandomEmail {
        // éšæœºç”Ÿæˆé‚®ç®±ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        maxRetries := 10
        for i := 0; i < maxRetries; i++ {
            accountEmail = generateRandomEmail()
            existing, _ := s.database.GetUserByEmail(accountEmail)
            if existing == nil {
                break // é‚®ç®±å¯ç”¨
            }
        }
        if accountEmail == "" {
            c.JSON(http.StatusInternalServerError, gin.H{"error": "æ— æ³•ç”Ÿæˆå”¯ä¸€é‚®ç®±ï¼Œè¯·é‡è¯•"})
            return
        }
    } else {
        accountEmail = req.Email
        // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
        existing, _ := s.database.GetUserByEmail(accountEmail)
        if existing != nil {
            c.JSON(http.StatusConflict, gin.H{"error": "é‚®ç®±å·²å­˜åœ¨"})
            return
        }
    }
    
    // ... åˆ›å»ºè´¦å· ...
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… éšæœºç”Ÿæˆæ—¶ï¼šé‡è¯•æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿæˆå”¯ä¸€é‚®ç®±
- âœ… æ‰‹åŠ¨è¾“å…¥æ—¶ï¼šæ£€æŸ¥å†²çªï¼Œè¿”å›æ˜ç¡®é”™è¯¯
- âœ… é”™è¯¯ç ï¼šä½¿ç”¨ 409 Conflict è¡¨ç¤ºèµ„æºå†²çª

### 6. äº¤æ˜“å‘˜è´¦å·é‡å¤åˆ›å»º

**åœºæ™¯ï¼š** äº¤æ˜“å‘˜å·²ç»æœ‰è´¦å·ï¼Œå†æ¬¡åˆ›å»ºè´¦å·

**å¤„ç†ç­–ç•¥ï¼š**
```go
func (s *Server) handleCreateTraderAccount(c *gin.Context) {
    traderID := c.Param("id")
    
    // æ£€æŸ¥äº¤æ˜“å‘˜æ˜¯å¦å·²æœ‰è´¦å·
    trader, _ := s.database.GetTraderByID(traderID)
    if trader == nil {
        c.JSON(http.StatusNotFound, gin.H{"error": "äº¤æ˜“å‘˜ä¸å­˜åœ¨"})
        return
    }
    
    if trader.TraderAccountID != "" {
        // æ£€æŸ¥è´¦å·æ˜¯å¦ä»ç„¶å­˜åœ¨
        account, _ := s.database.GetUserByID(trader.TraderAccountID)
        if account != nil {
            c.JSON(http.StatusConflict, gin.H{
                "error": "äº¤æ˜“å‘˜å·²æœ‰è´¦å·",
                "account_id": trader.TraderAccountID,
                "account_email": account.Email,
            })
            return
        }
        // å¦‚æœè´¦å·ä¸å­˜åœ¨ï¼Œæ¸…é™¤å…³è”ï¼Œå…è®¸é‡æ–°åˆ›å»º
        s.database.UpdateTraderAccountID(traderID, "")
    }
    
    // ... åˆ›å»ºè´¦å· ...
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ£€æŸ¥ç°æœ‰è´¦å·ï¼šé¿å…é‡å¤åˆ›å»º
- âœ… è´¦å·å·²åˆ é™¤çš„æƒ…å†µï¼šæ¸…é™¤å…³è”ï¼Œå…è®¸é‡æ–°åˆ›å»º
- âœ… è¿”å›ç°æœ‰è´¦å·ä¿¡æ¯ï¼šä¾¿äºå‰ç«¯æ˜¾ç¤º

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. æƒé™æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ 1.1ï¼šæ™®é€šç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„äº¤æ˜“å‘˜
```go
func TestUserCanOnlySeeOwnTraders(t *testing.T) {
    // 1. åˆ›å»ºä¸¤ä¸ªç”¨æˆ·
    user1 := createTestUser("user1@test.com", "user")
    user2 := createTestUser("user2@test.com", "user")
    
    // 2. ç”¨æˆ·1åˆ›å»ºäº¤æ˜“å‘˜
    trader1 := createTestTrader(user1.ID, "Trader 1")
    
    // 3. ç”¨æˆ·2åˆ›å»ºäº¤æ˜“å‘˜
    trader2 := createTestTrader(user2.ID, "Trader 2")
    
    // 4. ç”¨æˆ·1ç™»å½•ï¼Œè·å–äº¤æ˜“å‘˜åˆ—è¡¨
    traders1 := getTradersList(user1.ID)
    assert.Contains(t, traders1, trader1.ID)
    assert.NotContains(t, traders1, trader2.ID)
    
    // 5. ç”¨æˆ·2ç™»å½•ï¼Œè·å–äº¤æ˜“å‘˜åˆ—è¡¨
    traders2 := getTradersList(user2.ID)
    assert.Contains(t, traders2, trader2.ID)
    assert.NotContains(t, traders2, trader1.ID)
}
```

#### æµ‹è¯•ç”¨ä¾‹ 1.2ï¼šå°ç»„ç»„é•¿åªèƒ½çœ‹åˆ°ç®¡ç†çš„åˆ†ç±»çš„äº¤æ˜“å‘˜
```go
func TestGroupLeaderCanOnlySeeManagedCategories(t *testing.T) {
    // 1. åˆ›å»ºç”¨æˆ·å’Œåˆ†ç±»
    user := createTestUser("user@test.com", "user")
    category1 := createTestCategory(user.ID, "Category 1")
    category2 := createTestCategory(user.ID, "Category 2")
    
    // 2. åˆ›å»ºäº¤æ˜“å‘˜
    trader1 := createTestTraderWithCategory(user.ID, category1.Name)
    trader2 := createTestTraderWithCategory(user.ID, category2.Name)
    
    // 3. åˆ›å»ºå°ç»„ç»„é•¿ï¼Œåªç®¡ç† category1
    leader := createTestGroupLeader([]string{category1.Name}, user.ID)
    
    // 4. å°ç»„ç»„é•¿ç™»å½•ï¼Œè·å–äº¤æ˜“å‘˜åˆ—è¡¨
    traders := getTradersList(leader.ID)
    assert.Contains(t, traders, trader1.ID)
    assert.NotContains(t, traders, trader2.ID)
}
```

#### æµ‹è¯•ç”¨ä¾‹ 1.3ï¼šäº¤æ˜“å‘˜è´¦å·åªèƒ½çœ‹åˆ°è‡ªå·±çš„äº¤æ˜“å‘˜
```go
func TestTraderAccountCanOnlySeeOwnTrader(t *testing.T) {
    // 1. åˆ›å»ºç”¨æˆ·å’Œäº¤æ˜“å‘˜
    user := createTestUser("user@test.com", "user")
    trader1 := createTestTrader(user.ID, "Trader 1")
    trader2 := createTestTrader(user.ID, "Trader 2")
    
    // 2. ä¸º trader1 åˆ›å»ºè´¦å·
    account := createTestTraderAccount(trader1.ID)
    
    // 3. äº¤æ˜“å‘˜è´¦å·ç™»å½•ï¼Œè·å–äº¤æ˜“å‘˜åˆ—è¡¨
    traders := getTradersList(account.ID)
    assert.Contains(t, traders, trader1.ID)
    assert.NotContains(t, traders, trader2.ID)
    assert.Len(t, traders, 1)
}
```

### 2. ç™»å½•æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ 2.1ï¼šæ™®é€šç”¨æˆ·ç™»å½•éœ€è¦OTPéªŒè¯
```go
func TestUserLoginRequiresOTP(t *testing.T) {
    // 1. åˆ›å»ºæ™®é€šç”¨æˆ·ï¼ˆå·²è®¾ç½®OTPï¼‰
    user := createTestUserWithOTP("user@test.com", "user")
    
    // 2. å°è¯•ç™»å½•
    response := login(user.Email, "password")
    
    // 3. éªŒè¯è¿”å›éœ€è¦OTP
    assert.True(t, response.RequiresOTP)
    assert.Empty(t, response.Token)
    assert.Equal(t, user.ID, response.UserID)
}
```

#### æµ‹è¯•ç”¨ä¾‹ 2.2ï¼šåˆ›å»ºçš„è´¦å·ç™»å½•ä¸éœ€è¦OTP
```go
func TestCreatedAccountLoginNoOTP(t *testing.T) {
    // 1. åˆ›å»ºäº¤æ˜“å‘˜è´¦å·ï¼ˆä¸éœ€è¦OTPï¼‰
    account := createTestTraderAccount("trader123")
    
    // 2. å°è¯•ç™»å½•
    response := login(account.Email, "password")
    
    // 3. éªŒè¯ç›´æ¥è¿”å›token
    assert.False(t, response.RequiresOTP)
    assert.NotEmpty(t, response.Token)
    assert.Equal(t, account.ID, response.UserID)
}
```

### 3. è´¦å·åˆ›å»ºæµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ 3.1ï¼šæ™®é€šç”¨æˆ·åªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·
```go
func TestUserCanOnlyCreateAccountForOwnTrader(t *testing.T) {
    // 1. åˆ›å»ºä¸¤ä¸ªç”¨æˆ·
    user1 := createTestUser("user1@test.com", "user")
    user2 := createTestUser("user2@test.com", "user")
    
    // 2. ç”¨æˆ·1åˆ›å»ºäº¤æ˜“å‘˜
    trader := createTestTrader(user1.ID, "Trader 1")
    
    // 3. ç”¨æˆ·2å°è¯•ä¸ºè¯¥äº¤æ˜“å‘˜åˆ›å»ºè´¦å·ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
    response := createTraderAccount(user2.ID, trader.ID)
    assert.Equal(t, http.StatusForbidden, response.StatusCode)
    assert.Contains(t, response.Error, "åªèƒ½ä¸ºè‡ªå·±çš„äº¤æ˜“å‘˜åˆ›å»ºè´¦å·")
    
    // 4. ç”¨æˆ·1åˆ›å»ºè´¦å·ï¼ˆåº”è¯¥æˆåŠŸï¼‰
    response = createTraderAccount(user1.ID, trader.ID)
    assert.Equal(t, http.StatusOK, response.StatusCode)
}
```

#### æµ‹è¯•ç”¨ä¾‹ 3.2ï¼šéšæœºç”Ÿæˆè´¦å·å’Œå¯†ç 
```go
func TestRandomAccountGeneration(t *testing.T) {
    // 1. åˆ›å»ºç”¨æˆ·å’Œäº¤æ˜“å‘˜
    user := createTestUser("user@test.com", "user")
    trader := createTestTrader(user.ID, "Trader 1")
    
    // 2. è¯·æ±‚éšæœºç”Ÿæˆè´¦å·å’Œå¯†ç 
    req := CreateAccountRequest{
        GenerateRandomEmail:    true,
        GenerateRandomPassword: true,
    }
    
    // 3. åˆ›å»ºè´¦å·
    response := createTraderAccountWithRequest(user.ID, trader.ID, req)
    
    // 4. éªŒè¯è¿”å›çš„è´¦å·å’Œå¯†ç 
    assert.NotEmpty(t, response.Email)
    assert.NotEmpty(t, response.Password)
    assert.Contains(t, response.Email, "@nofx.local")
    assert.Len(t, response.Password, 12) // é»˜è®¤12ä½å¯†ç 
}
```

### 4. åˆ†ç±»ç®¡ç†æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ 4.1ï¼šæ™®é€šç”¨æˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„åˆ†ç±»
```go
func TestUserCanOnlyManageOwnCategories(t *testing.T) {
    // 1. åˆ›å»ºä¸¤ä¸ªç”¨æˆ·
    user1 := createTestUser("user1@test.com", "user")
    user2 := createTestUser("user2@test.com", "user")
    
    // 2. ç”¨æˆ·1åˆ›å»ºåˆ†ç±»
    category := createTestCategory(user1.ID, "Category 1")
    
    // 3. ç”¨æˆ·2å°è¯•åˆ é™¤è¯¥åˆ†ç±»ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
    response := deleteCategory(user2.ID, category.ID)
    assert.Equal(t, http.StatusForbidden, response.StatusCode)
    
    // 4. ç”¨æˆ·1åˆ é™¤åˆ†ç±»ï¼ˆåº”è¯¥æˆåŠŸï¼‰
    response = deleteCategory(user1.ID, category.ID)
    assert.Equal(t, http.StatusOK, response.StatusCode)
}
```

#### æµ‹è¯•ç”¨ä¾‹ 4.2ï¼šåˆ é™¤åˆ†ç±»æ—¶äº¤æ˜“å‘˜åˆ†ç±»å­—æ®µè¢«æ¸…ç©º
```go
func TestDeleteCategoryClearsTraderCategory(t *testing.T) {
    // 1. åˆ›å»ºç”¨æˆ·ã€åˆ†ç±»å’Œäº¤æ˜“å‘˜
    user := createTestUser("user@test.com", "user")
    category := createTestCategory(user.ID, "Category 1")
    trader := createTestTraderWithCategory(user.ID, category.Name)
    
    // 2. éªŒè¯äº¤æ˜“å‘˜æœ‰åˆ†ç±»
    assert.Equal(t, category.Name, trader.Category)
    
    // 3. åˆ é™¤åˆ†ç±»
    deleteCategory(user.ID, category.ID)
    
    // 4. éªŒè¯äº¤æ˜“å‘˜çš„åˆ†ç±»å­—æ®µè¢«æ¸…ç©º
    updatedTrader := getTrader(trader.ID)
    assert.Empty(t, updatedTrader.Category)
}
```

---

## â“ å¸¸è§é—®é¢˜ FAQ

### Q1: ç°æœ‰ç”¨æˆ·å¦‚ä½•å‡çº§åˆ°æ–°ç³»ç»Ÿï¼Ÿ

**A:** ç°æœ‰ç”¨æˆ·æ— éœ€ä»»ä½•æ“ä½œï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š
- ç°æœ‰ç”¨æˆ·çš„ `role` å­—æ®µä¼šè‡ªåŠ¨è®¾ç½®ä¸º `'user'`ï¼ˆé€šè¿‡æ•°æ®åº“è¿ç§»ï¼‰
- ç°æœ‰äº¤æ˜“å‘˜çš„ `owner_user_id` ä¼šæ ¹æ® `user_id` å­—æ®µè‡ªåŠ¨è®¾ç½®ï¼ˆé€šè¿‡è¿ç§»è„šæœ¬ï¼‰
- ç°æœ‰åŠŸèƒ½å®Œå…¨ä¿ç•™ï¼Œå‘åå…¼å®¹

### Q2: å¦‚æœäº¤æ˜“å‘˜æ²¡æœ‰åˆ†ç±»ï¼Œä¼šæ€æ ·ï¼Ÿ

**A:** äº¤æ˜“å‘˜å¯ä»¥æ²¡æœ‰åˆ†ç±»ï¼ˆ`category` ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ï¼š
- æ™®é€šç”¨æˆ·å¯ä»¥çœ‹åˆ° `owner_user_id` ä¸ºè‡ªå·±çš„æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆåŒ…æ‹¬æ²¡æœ‰åˆ†ç±»çš„ï¼‰
- äº¤æ˜“å‘˜è´¦å·å¯ä»¥æ­£å¸¸åˆ›å»ºå’Œä½¿ç”¨ï¼ˆä¸å—åˆ†ç±»é™åˆ¶ï¼‰
- åˆ é™¤åˆ†ç±»æ—¶ï¼Œè¯¥åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜çš„ `category` ä¼šè¢«æ¸…ç©ºï¼Œä½†äº¤æ˜“å‘˜ä¸ä¼šè¢«åˆ é™¤

### Q3: å°ç»„ç»„é•¿å¯ä»¥ä¿®æ”¹åˆ†ç±»å—ï¼Ÿ

**A:** ä¸å¯ä»¥ã€‚å°ç»„ç»„é•¿æ˜¯åªè¯»è§’è‰²ï¼š
- åªèƒ½æŸ¥çœ‹ç®¡ç†çš„åˆ†ç±»ä¸‹çš„äº¤æ˜“å‘˜æ•°æ®
- ä¸èƒ½åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤äº¤æ˜“å‘˜
- ä¸èƒ½ä¿®æ”¹åˆ†ç±»ä¿¡æ¯
- ä¸èƒ½åˆ›å»ºè´¦å·

### Q4: ä¸€ä¸ªäº¤æ˜“å‘˜å¯ä»¥æœ‰å¤šä¸ªè´¦å·å—ï¼Ÿ

**A:** ä¸å¯ä»¥ã€‚ä¸€ä¸ªäº¤æ˜“å‘˜åªèƒ½å…³è”ä¸€ä¸ªäº¤æ˜“å‘˜è´¦å·ï¼ˆ`trader_account_id`ï¼‰ï¼š
- å¦‚æœäº¤æ˜“å‘˜å·²æœ‰è´¦å·ï¼Œå†æ¬¡åˆ›å»ºä¼šè¿”å›é”™è¯¯
- å¦‚æœéœ€è¦æ›´æ¢è´¦å·ï¼Œéœ€è¦å…ˆåˆ é™¤ç°æœ‰è´¦å·ï¼Œå†åˆ›å»ºæ–°è´¦å·

### Q5: ä¸€ä¸ªå°ç»„ç»„é•¿å¯ä»¥ç®¡ç†å¤šä¸ªåˆ†ç±»å—ï¼Ÿ

**A:** å¯ä»¥ã€‚ä¸€ä¸ªå°ç»„ç»„é•¿å¯ä»¥è§‚æµ‹å¤šä¸ªåˆ†ç±»ï¼š
- åˆ›å»ºå°ç»„ç»„é•¿æ—¶ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåˆ†ç±»
- å°ç»„ç»„é•¿å¯ä»¥çœ‹åˆ°è¿™äº›åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜
- åç»­å¯ä»¥é€šè¿‡æ›´æ–°æ¥å£ä¿®æ”¹ç®¡ç†çš„åˆ†ç±»åˆ—è¡¨

### Q6: Admin Mode å’Œ role='admin' æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼š
- **Admin Mode** (`config.json` ä¸­çš„ `admin_mode`): ç³»ç»Ÿçº§å¼€å…³ï¼Œæ§åˆ¶æ˜¯å¦å…è®¸ç”¨æˆ·æ³¨å†Œ
  - `admin_mode=true`: ç¦ç”¨æ³¨å†Œï¼Œåªèƒ½é€šè¿‡ `/api/admin-login` ç™»å½•
  - `admin_mode=false`: å…è®¸ç”¨æˆ·æ³¨å†Œ
- **role='admin'**: ç”¨æˆ·çº§è§’è‰²ï¼Œæ§åˆ¶ç”¨æˆ·æƒé™
  - å¯ä»¥ç®¡ç†æ‰€æœ‰äº¤æ˜“å‘˜ï¼ˆè·¨ç”¨æˆ·ï¼‰
  - å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„è´¦å·
  - éœ€è¦ OTP éªŒè¯
  - **æ³¨æ„ï¼š** ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨æ­¤è§’è‰²ï¼Œé»˜è®¤ä½¿ç”¨ User è§’è‰²

### Q7: åˆ›å»ºçš„è´¦å·å¯†ç å¿˜è®°äº†æ€ä¹ˆåŠï¼Ÿ

**A:** ç›®å‰éœ€è¦æ™®é€šç”¨æˆ·ï¼ˆåˆ›å»ºè€…ï¼‰é‡ç½®å¯†ç ï¼š
- æ™®é€šç”¨æˆ·å¯ä»¥é‡ç½®è‡ªå·±åˆ›å»ºçš„äº¤æ˜“å‘˜è´¦å·å¯†ç 
- æ™®é€šç”¨æˆ·å¯ä»¥é‡ç½®è‡ªå·±åˆ›å»ºçš„å°ç»„ç»„é•¿å¯†ç 
- åç»­å¯ä»¥æ·»åŠ "å¿˜è®°å¯†ç "åŠŸèƒ½ï¼ˆéœ€è¦é‚®ç®±éªŒè¯ï¼‰

### Q8: åˆ†ç±»åç§°å¯ä»¥é‡å¤å—ï¼Ÿ

**A:** åŒä¸€ç”¨æˆ·ä¸‹ä¸èƒ½æœ‰é‡å¤çš„åˆ†ç±»åç§°ï¼š
- ä¸åŒç”¨æˆ·å¯ä»¥åˆ›å»ºç›¸åŒåç§°çš„åˆ†ç±»ï¼ˆæ•°æ®éš”ç¦»ï¼‰
- åŒä¸€ç”¨æˆ·ä¸èƒ½åˆ›å»ºé‡å¤çš„åˆ†ç±»åç§°
- ä¿®æ”¹åˆ†ç±»åç§°æ—¶ï¼Œä¹Ÿä¼šæ£€æŸ¥æ–°åç§°æ˜¯å¦å·²å­˜åœ¨

### Q9: åˆ é™¤åˆ†ç±»ä¼šå½±å“äº¤æ˜“å‘˜å—ï¼Ÿ

**A:** ä¸ä¼šåˆ é™¤äº¤æ˜“å‘˜ï¼Œåªä¼šæ¸…ç©ºåˆ†ç±»å­—æ®µï¼š
- åˆ é™¤åˆ†ç±»æ—¶ï¼Œè¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰äº¤æ˜“å‘˜çš„ `category` å­—æ®µä¼šè¢«è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²
- äº¤æ˜“å‘˜ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯ä¸å†å±äºä»»ä½•åˆ†ç±»
- å°ç»„ç»„é•¿å¦‚æœåªè§‚æµ‹è¯¥åˆ†ç±»ï¼Œåˆ é™¤åˆ†ç±»åè¯¥å…³è”å…³ç³»ä¼šè¢«åˆ é™¤

### Q10: å¦‚ä½•å°†ç°æœ‰äº¤æ˜“å‘˜åˆ†é…åˆ°åˆ†ç±»ï¼Ÿ

**A:** æœ‰ä¸¤ç§æ–¹å¼ï¼š
1. **åˆ›å»ºäº¤æ˜“å‘˜æ—¶æŒ‡å®šåˆ†ç±»**ï¼šåœ¨åˆ›å»ºäº¤æ˜“å‘˜æ—¶æä¾› `category` å‚æ•°
2. **åç»­è®¾ç½®åˆ†ç±»**ï¼šé€šè¿‡ `POST /api/traders/:id/category` æ¥å£è®¾ç½®äº¤æ˜“å‘˜åˆ†ç±»

---

## ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“è¿ç§»é¡ºåº

**é‡è¦ï¼š** å¿…é¡»æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼š

```sql
-- æ­¥éª¤1: æ‰©å±•ç”¨æˆ·è¡¨
ALTER TABLE users ADD COLUMN role TEXT DEFAULT 'user';
ALTER TABLE users ADD COLUMN trader_id TEXT DEFAULT NULL;
ALTER TABLE users ADD COLUMN category TEXT DEFAULT NULL;

-- æ­¥éª¤2: æ‰©å±•äº¤æ˜“å‘˜è¡¨
ALTER TABLE traders ADD COLUMN category TEXT DEFAULT '';
ALTER TABLE traders ADD COLUMN trader_account_id TEXT DEFAULT NULL;
ALTER TABLE traders ADD COLUMN owner_user_id TEXT DEFAULT NULL;

-- æ­¥éª¤3: åˆ›å»ºåˆ†ç±»è¡¨
CREATE TABLE IF NOT EXISTS categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    owner_user_id TEXT NOT NULL,
    description TEXT DEFAULT '',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(owner_user_id, name)
);

-- æ­¥éª¤4: åˆ›å»ºå°ç»„ç»„é•¿åˆ†ç±»å…³è”è¡¨
CREATE TABLE IF NOT EXISTS group_leader_categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    group_leader_id TEXT NOT NULL,
    category TEXT NOT NULL,
    owner_user_id TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (group_leader_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(group_leader_id, category)
);

-- æ­¥éª¤5: åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_owner_user ON categories(owner_user_id);
CREATE INDEX IF NOT EXISTS idx_group_leader ON group_leader_categories(group_leader_id);
CREATE INDEX IF NOT EXISTS idx_category ON group_leader_categories(category);
CREATE INDEX IF NOT EXISTS idx_owner_user_gl ON group_leader_categories(owner_user_id);

-- æ­¥éª¤6: æ•°æ®è¿ç§»ï¼ˆé€šè¿‡ä»£ç æ‰§è¡Œï¼‰
-- è®¾ç½®ç°æœ‰ç”¨æˆ·çš„role
UPDATE users SET role = 'user' WHERE role IS NULL OR role = '';

-- è®¾ç½®ç°æœ‰äº¤æ˜“å‘˜çš„owner_user_idï¼ˆå¦‚æœtradersè¡¨æœ‰user_idå­—æ®µï¼‰
UPDATE traders SET owner_user_id = user_id WHERE owner_user_id IS NULL AND user_id IS NOT NULL;
```

### 2. å¤‡ä»½ç­–ç•¥

**éƒ¨ç½²å‰å¿…é¡»å¤‡ä»½ï¼š**
```bash
# å¤‡ä»½æ•°æ®åº“
cp nofx.db nofx.db.backup.$(date +%Y%m%d_%H%M%S)

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp config.json config.json.backup.$(date +%Y%m%d_%H%M%S)
```

### 3. å›æ»šæ–¹æ¡ˆ

**å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥å›æ»šï¼š**
```sql
-- æ³¨æ„ï¼šSQLiteä¸æ”¯æŒDROP COLUMNï¼Œéœ€è¦é‡å»ºè¡¨
-- å¦‚æœè¿ç§»å¤±è´¥ï¼Œæ¢å¤å¤‡ä»½æ•°æ®åº“
cp nofx.db.backup.xxx nofx.db
```

### 4. æ€§èƒ½ä¼˜åŒ–å»ºè®®

**æ•°æ®åº“ç´¢å¼•ï¼š**
- âœ… å·²ä¸º `categories.owner_user_id` åˆ›å»ºç´¢å¼•
- âœ… å·²ä¸º `group_leader_categories.group_leader_id` åˆ›å»ºç´¢å¼•
- âœ… å·²ä¸º `group_leader_categories.category` åˆ›å»ºç´¢å¼•
- âœ… å·²ä¸º `group_leader_categories.owner_user_id` åˆ›å»ºç´¢å¼•
- âš ï¸ å»ºè®®ä¸º `traders.owner_user_id` åˆ›å»ºç´¢å¼•ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
- âš ï¸ å»ºè®®ä¸º `traders.category` åˆ›å»ºç´¢å¼•ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰

**æŸ¥è¯¢ä¼˜åŒ–ï¼š**
```go
// ä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢
SELECT * FROM traders WHERE owner_user_id = ?  // ä½¿ç”¨ç´¢å¼•
SELECT * FROM traders WHERE category = ?       // ä½¿ç”¨ç´¢å¼•

// é¿å…å…¨è¡¨æ‰«æ
SELECT * FROM traders WHERE name LIKE '%test%'  // é¿å…ä½¿ç”¨ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œè€ƒè™‘å…¨æ–‡æœç´¢
```

### 5. ç›‘æ§å’Œæ—¥å¿—

**å…³é”®æ—¥å¿—ç‚¹ï¼š**
```go
// 1. æƒé™æ£€æŸ¥å¤±è´¥
log.Printf("æƒé™æ£€æŸ¥å¤±è´¥: user_id=%s, role=%s, action=%s", userID, role, action)

// 2. è´¦å·åˆ›å»º
log.Printf("åˆ›å»ºè´¦å·: user_id=%s, role=%s, email=%s", userID, role, email)

// 3. åˆ†ç±»æ“ä½œ
log.Printf("åˆ†ç±»æ“ä½œ: user_id=%s, category=%s, action=%s", userID, category, action)

// 4. æ•°æ®è¿ç§»
log.Printf("æ•°æ®è¿ç§»: step=%s, status=%s", step, status)
```

### 6. ç¯å¢ƒå˜é‡é…ç½®

**å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š**
```bash
# æ•°æ®åº“è·¯å¾„
export NOFX_DB_PATH=/path/to/nofx.db

# æ—¥å¿—çº§åˆ«
export NOFX_LOG_LEVEL=info

# Admin Mode
export NOFX_ADMIN_MODE=false
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### ç›¸å…³æ–‡ä»¶ä½ç½®

**åç«¯æ–‡ä»¶ï¼š**
- `api/server.go` - APIè·¯ç”±å’Œå¤„ç†å‡½æ•°
- `config/database.go` - æ•°æ®åº“æ“ä½œ
- `auth/auth.go` - è®¤è¯å’Œæˆæƒ

**å‰ç«¯æ–‡ä»¶ï¼š**
- `web/src/components/AITradersPage.tsx` - äº¤æ˜“å‘˜åˆ—è¡¨é¡µé¢
- `web/src/components/LoginPage.tsx` - ç™»å½•é¡µé¢
- `web/src/contexts/AuthContext.tsx` - è®¤è¯ä¸Šä¸‹æ–‡
- `web/src/App.tsx` - ä¸»åº”ç”¨ç»„ä»¶

**æ•°æ®åº“ï¼š**
- `nofx.db` - SQLiteæ•°æ®åº“æ–‡ä»¶

### ç›¸å…³APIç«¯ç‚¹

**ç”¨æˆ·ç›¸å…³ï¼š**
- `POST /api/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/login` - ç”¨æˆ·ç™»å½•
- `GET /api/account` - è·å–è´¦æˆ·ä¿¡æ¯

**äº¤æ˜“å‘˜ç›¸å…³ï¼š**
- `GET /api/my-traders` - è·å–äº¤æ˜“å‘˜åˆ—è¡¨
- `GET /api/traders/:id` - è·å–äº¤æ˜“å‘˜è¯¦æƒ…
- `POST /api/traders` - åˆ›å»ºäº¤æ˜“å‘˜
- `POST /api/traders/:id/create-account` - åˆ›å»ºäº¤æ˜“å‘˜è´¦å·

**åˆ†ç±»ç›¸å…³ï¼š**
- `GET /api/categories` - è·å–åˆ†ç±»åˆ—è¡¨
- `POST /api/categories` - åˆ›å»ºåˆ†ç±»
- `PUT /api/categories/:id` - æ›´æ–°åˆ†ç±»
- `DELETE /api/categories/:id` - åˆ é™¤åˆ†ç±»
- `POST /api/traders/:id/category` - è®¾ç½®äº¤æ˜“å‘˜åˆ†ç±»

**å°ç»„ç»„é•¿ç›¸å…³ï¼š**
- `POST /api/group-leaders/create` - åˆ›å»ºå°ç»„ç»„é•¿è´¦å·
- `GET /api/group-leaders` - è·å–å°ç»„ç»„é•¿åˆ—è¡¨
- `PUT /api/group-leaders/:id/categories` - æ›´æ–°å°ç»„ç»„é•¿åˆ†ç±»
- `DELETE /api/group-leaders/:id` - åˆ é™¤å°ç»„ç»„é•¿è´¦å·

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.0.0 (2024-01-XX)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… å››çº§æƒé™ä½“ç³»ï¼ˆAdmin / User / Group Leader / Trader Accountï¼‰
- âœ… åˆ†ç±»ç®¡ç†åŠŸèƒ½
- âœ… è´¦å·åˆ›å»ºåŠŸèƒ½
- âœ… æ•°æ®éš”ç¦»å’Œæƒé™æ§åˆ¶

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2024-01-XX
- åˆå§‹æ–‡æ¡£åˆ›å»º
- å®Œæˆç³»ç»Ÿæ¶æ„è®¾è®¡
- å®ŒæˆAPIè®¾è®¡
- å®Œæˆå‰ç«¯ç•Œé¢è®¾è®¡
- å®Œæˆå®ç°æ­¥éª¤è§„åˆ’

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**æœ€åæ›´æ–°ï¼š** 2024-01-XX  
**ç»´æŠ¤è€…ï¼š** NOFX Team
